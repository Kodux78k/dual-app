<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Ultimate Finale â€” ASCII Portal Generator (Presets â€¢ Texto â€¢ Imagem â€¢ MÃºsica)</title>
<meta name="description" content="Gerador standalone (HTML Ãºnico) que transforma frames ASCII (portais) em prompts de Texto, Imagem e MÃºsica. Agora com presets injetados.">
<style>
  :root{
    --bg:#0b0d10; --panel:#12151a; --panel-2:#0f1216;
    --accent:#6ee7ff; --accent-2:#a78bfa; --soft:#cbd5e1;
    --text:#e6edf3; --muted:#9aa4b2; --shadow:0 10px 30px rgba(0,0,0,.45);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 700px at 20% 0%, rgba(103,232,249,.10), transparent 60%),
      radial-gradient(1000px 600px at 100% 10%, rgba(167,139,250,.12), transparent 60%),
      linear-gradient(180deg, #0a0c10, #07090c 20%, #05070b 60%);
    background-color:var(--bg);
    padding-bottom: env(safe-area-inset-bottom);
  }
  header{
    position:sticky; top:0; z-index:3; backdrop-filter: blur(8px);
    background: linear-gradient(180deg, rgba(10,12,16,.92), rgba(10,12,16,.68));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .wrap{max-width:1100px; margin:0 auto; padding: 14px 14px;}
  .title{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .badge,.pill{padding:6px 10px; border:1px solid rgba(255,255,255,.14); border-radius:999px; font-size:12px; color:var(--soft)}
  .pill{background:linear-gradient(90deg, rgba(110,231,255,.16), rgba(167,139,250,.16))}
  h1{font-size:18px; margin:0}
  h2{font-size:15px; margin:0; color:var(--soft)}
  .grid{display:grid; gap:12px}
  @media(min-width:980px){ .grid-2{grid-template-columns: 1.15fr .85fr;} }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border:1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow: var(--shadow);
  }
  .card .hd{padding:12px; border-bottom:1px solid rgba(255,255,255,.06); display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  .card .bd{padding:12px}
  label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
  textarea,input{width:100%; background:var(--panel-2); border:1px solid rgba(255,255,255,.12); color:var(--text); border-radius:12px; padding:12px; outline:none}
  textarea{min-height:160px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Courier New", monospace;
    white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word;}
  .row{display:grid; gap:10px}
  @media(min-width:740px){ .row-2{grid-template-columns: repeat(2,1fr)} .row-3{grid-template-columns: repeat(3,1fr)} }
  .btn{appearance:none; border:1px solid rgba(255,255,255,.16); color:var(--text);
    background: linear-gradient(90deg, rgba(110,231,255,.15), rgba(167,139,250,.15));
    padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600; font-size:14px}
  .btn.small{font-size:12px; padding:8px 10px}
  .btn.ghost{background:transparent}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap}
  .symbar{display:flex; gap:8px; padding:8px; background:rgba(255,255,255,.04); border:1px dashed rgba(255,255,255,.12); border-radius:12px;
    overflow:auto; -webkit-overflow-scrolling:touch}
  .sym{padding:8px 10px; border-radius:10px; cursor:pointer; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); white-space:nowrap; flex:0 0 auto}
  .sym:hover{background:rgba(255,255,255,.12)}
  .presetbar{display:flex; gap:8px; overflow:auto; -webkit-overflow-scrolling:touch; padding:8px; border:1px dashed rgba(255,255,255,.12); border-radius:12px}
  .chip{flex:0 0 auto; display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border:1px solid rgba(255,255,255,.18); border-radius:999px; font-size:12px; color:var(--soft); background:rgba(255,255,255,.05)}
  .chip:hover{filter:brightness(1.08); cursor:pointer}
  .out{min-height:120px}
  .switch{display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none}
  .switch input{display:none}
  .switch .knob{width:42px; height:26px; border-radius:20px; background: rgba(255,255,255,.14); position:relative; transition:.2s}
  .switch .knob::after{content:""; position:absolute; top:3px; left:3px; width:20px; height:20px; border-radius:50%; background:#fff; transition:.2s}
  .switch input:checked + .knob{background: linear-gradient(90deg, var(--accent), var(--accent-2))}
  .switch input:checked + .knob::after{transform: translateX(16px)}
  .help{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:20px; z-index:10; background: rgba(0,0,0,.5); backdrop-filter: blur(6px)}
  .help .modal{max-width:900px; width:100%; background: var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow: var(--shadow); max-height:88vh; overflow:auto}
  .toast{position:fixed; right:12px; bottom:calc(12px + env(safe-area-inset-bottom)); background: rgba(20,24,30,.92); border:1px solid rgba(255,255,255,.14); padding:10px 14px; border-radius:12px; display:none}
  .footer{text-align:center; color:var(--muted); padding:22px 12px; font-size:12px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <h1>Ultimate Finale â€” ASCII Portal Generator</h1>
      <span class="pill">Standalone â€¢ HTML Ãºnico</span>
      <span class="badge">Texto â€¢ Imagem â€¢ MÃºsica</span>
      <span class="badge">âˆ Safe â€¢ Â§ QA</span>
    </div>
  </div>
</header>

<main class="wrap grid grid-2" style="margin-top:10px">
  <section class="card">
    <div class="hd">
      <h2>1) Frame ASCII (portal) â€¢ Presets</h2>
      <div class="toolbar">
        <button class="btn small" id="btnUNO">âŠ™ UNO</button>
        <button class="btn small" id="btnDUAL">â— DUAL</button>
        <button class="btn small" id="btnTRI">â–³ TRINITY</button>
        <button class="btn small" id="btnHelp">Tabela ASCII â–¤</button>
      </div>
    </div>
    <div class="bd">
      <div class="presetbar" id="framePresets"></div>
      <div style="height:8px"></div>
      <label for="frame">Cole ou use um preset</label>
      <textarea id="frame" placeholder="Ex.: âŠ™UNOâ–ˆâ–€â–ˆ â‡„DUALâ•”â•â•— â–³TRINITYâ˜†å½¡&#10;â•”â•â•—  #ROOT:KODUX  ğŸ’ MINI-SRV&#10;â”‚ â—  DUAL on    â—‡ Validador&#10;â”‚ Â§  QA         â–’ densidade&#10;â• â–ˆâ–€â–ˆ&#10;â•šâ•â• âˆ"></textarea>
      <div style="height:8px"></div>
      <div class="symbar" id="symbar">
        <span class="sym" data-sym="â•”â•â•—">â•”â•â•—</span><span class="sym" data-sym="â•šâ•â•">â•šâ•â•</span>
        <span class="sym" data-sym="â”‚">â”‚</span><span class="sym" data-sym="â•">â•</span><span class="sym" data-sym="â–ˆâ–€â–ˆ">â–ˆâ–€â–ˆ</span>
        <span class="sym" data-sym="âŠ™">âŠ™</span><span class="sym" data-sym="â‡„">â‡„</span><span class="sym" data-sym="â—">â—</span><span class="sym" data-sym="â–³">â–³</span>
        <span class="sym" data-sym="â˜†å½¡">â˜†å½¡</span><span class="sym" data-sym="â—‡">â—‡</span><span class="sym" data-sym="âˆ">âˆ</span><span class="sym" data-sym="Â§">Â§</span>
        <span class="sym" data-sym="â–²">â–²</span><span class="sym" data-sym="â–¼">â–¼</span><span class="sym" data-sym="â–º">â–º</span><span class="sym" data-sym="â—„">â—„</span>
        <span class="sym" data-sym="â–‘">â–‘</span><span class="sym" data-sym="â–’">â–’</span><span class="sym" data-sym="â–“">â–“</span><span class="sym" data-sym="#">#</span><span class="sym" data-sym="ğŸ’ ">ğŸ’ </span>
      </div>
      <div style="height:10px"></div>
      <div class="row row-3">
        <div>
          <label>Tema/assunto</label>
          <input id="topic" placeholder="Ex.: trilha mÃ­stica com tambores e sintetizadores"/>
          <div class="presetbar" id="topicPresets"></div>
        </div>
        <div>
          <label>Estilo</label>
          <input id="style" placeholder="Ex.: neon tribal, cinematogrÃ¡fico, minimalista"/>
          <div class="presetbar" id="stylePresets"></div>
        </div>
        <div>
          <label>AudiÃªncia</label>
          <input id="aud" placeholder="Ex.: criadores, pÃºblico geral, DJs, leitores"/>
          <div class="presetbar" id="audPresets"></div>
        </div>
      </div>
      <div style="height:10px"></div>
      <label>Extras / requisitos</label>
      <textarea id="extras" placeholder="Ex.: foco em percussÃ£o, evitar clichÃªs, usar linguagem inclusiva, 120-128 BPM, 16:9"></textarea>
      <div class="presetbar" id="extraPresets"></div>
      <div style="height:10px"></div>
      <div class="toolbar">
        <label class="switch"><input type="checkbox" id="cabX"><span class="knob"></span> Cabelos X</label>
        <label class="switch"><input type="checkbox" id="cabY"><span class="knob"></span> Cabelos Y</label>
        <label class="switch"><input type="checkbox" id="cabZ"><span class="knob"></span> Cabelos Z</label>
        <label class="switch"><input type="checkbox" id="qaOn" checked><span class="knob"></span> Â§ QA</label>
        <label class="switch"><input type="checkbox" id="safeOn" checked><span class="knob"></span> âˆ Safe</label>
      </div>
      <div style="height:10px"></div>
      <div class="toolbar">
        <button class="btn" id="btnGenerate">âš¡ Gerar prompts</button>
        <button class="btn ghost" id="btnClear">Limpar</button>
        <button class="btn ghost" id="btnImport">Importar frame (.txt)</button><input type="file" id="fileIn" accept=".txt" style="display:none"/>
        <button class="btn ghost" id="btnExport">Exportar frame (.txt)</button>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="hd">
      <h2>2) SaÃ­da (prompts gerados)</h2>
      <div class="toolbar">
        <button class="btn small" id="btnDownloadMD">â¬‡ FULL.md</button>
        <button class="btn small" id="btnDownloadJSON">â¬‡ JSON</button>
      </div>
    </div>
    <div class="bd">
      <div class="row">
        <div class="card">
          <div class="hd"><strong>ğŸ“ Texto</strong><button class="btn small ghost" data-copy="#outText">Copiar</button></div>
          <div class="bd"><textarea id="outText" class="out"></textarea></div>
        </div>
        <div class="card">
          <div class="hd"><strong>ğŸ–¼ï¸ Imagem</strong><button class="btn small ghost" data-copy="#outImage">Copiar</button></div>
          <div class="bd"><textarea id="outImage" class="out"></textarea></div>
        </div>
        <div class="card">
          <div class="hd"><strong>ğŸµ MÃºsica</strong><button class="btn small ghost" data-copy="#outMusic">Copiar</button></div>
          <div class="bd"><textarea id="outMusic" class="out"></textarea></div>
        </div>
        <div class="card">
          <div class="hd"><strong>ğŸ”– Selo Dual</strong><button class="btn small ghost" data-copy="#outSelo">Copiar</button></div>
          <div class="bd"><textarea id="outSelo" class="out mono"></textarea></div>
        </div>
      </div>
    </div>
  </section>
</main>

<section class="wrap">
  <div class="card">
    <div class="hd"><h2>3) Presets de CombinaÃ§Ãµes (1 clique)</h2></div>
    <div class="bd">
      <div class="presetbar" id="comboPresets"></div>
    </div>
  </div>
</section>

<section class="wrap">
  <div class="card">
    <div class="hd"><h2>4) Notas</h2></div>
    <div class="bd">
      <ul style="color:var(--muted); font-size:12px; margin:0; padding-left:18px">
        <li>Regra de certeza: âŠ™ UNO (direto); Incerteza: â—/â‡„ DUAL; SÃ­ntese: â–³ TRINITY.</li>
        <li>Densidade: â–‘ (curto), â–’ (mÃ©dio), â–“ (detalhado). â˜†å½¡ eleva estÃ©tica; â–ˆâ–€â–ˆ aumenta forÃ§a.</li>
        <li>Â§ QA para coerÃªncia; âˆ garante saÃ­da segura; â—‡ marca integraÃ§Ãµes (este app Ã© offline).</li>
      </ul>
    </div>
  </div>
</section>

<div class="help" id="help">
  <div class="modal">
    <div class="hd" style="padding:12px; border-bottom:1px solid rgba(255,255,255,.06)"><h2>Tabela ASCII â€¢ Portais e FunÃ§Ãµes</h2></div>
    <div class="bd" style="padding:12px">
<pre class="mono" style="font-size:12px; white-space:pre-wrap">
â•”â•â•— / â•šâ•â•   â†’ Portal raiz / Estrutura do frame
â”‚           â†’ Fluxo interno / Caminho ativo
â•           â†’ NÃºcleo / Energia estabilizada
â–ˆâ–€â–ˆ         â†’ ForÃ§a / Abertura de camada
âŠ™           â†’ UNO / Centro do arquÃ©tipo
â‡„ / â—       â†’ DUAL / Troca de polaridade e presenÃ§a contÃ­nua
â–³           â†’ TRINITY / SÃ­ntese em trÃªs camadas
â˜†å½¡         â†’ EstÃ©tica / ExpansÃ£o criativa
â—‡           â†’ API sensorial / Chamadas externas (n8n, apps)
âˆ           â†’ Safe mode / SaÃ­da sem crash
Â§           â†’ QA / Arbitragem inteligente
â–²â–¼â–ºâ—„        â†’ DireÃ§Ãµes / NavegaÃ§Ã£o de estados
â–‘â–’â–“         â†’ Densidade / Intensidade de ativaÃ§Ã£o
#           â†’ Chave Mestra / Root fixo
ğŸ’           â†’ Mini-servidor dual (n8n hub)
</pre>
      <div class="toolbar"><button class="btn" id="btnCloseHelp">Fechar</button></div>
    </div>
  </div>
</div>

<div class="toast" id="toast">Copiado!</div>

<script>
const $ = (q, el=document)=> el.querySelector(q);
const $$ = (q, el=document)=> Array.from(el.querySelectorAll(q));
function toast(msg="Copiado!"){ const t=$("#toast"); t.textContent=msg; t.style.display="block"; setTimeout(()=>t.style.display="none",1200); }
function insertAtCursor(textarea, text){
  const start = textarea.selectionStart ?? textarea.value.length;
  const end = textarea.selectionEnd ?? textarea.value.length;
  const before = textarea.value.substring(0,start);
  const after = textarea.value.substring(end);
  textarea.value = before + text + after;
  autoResize(textarea);
  textarea.focus();
  const pos = start + text.length;
  textarea.setSelectionRange(pos,pos);
}
function autoResize(t){
  t.style.height = "auto";
  t.style.height = Math.min(320, Math.max(120, t.scrollHeight)) + "px";
}

// ===== PRESETS =====
const frameLibrary = {
  "MÃºsica Ritual": `â•”â•â•—  #ROOT:KODUX  ARCH:INFODOSE12
â”‚ â–³  C1: tÃ©cnica  C2: simbÃ³lica  C3: prÃ¡tica
â”‚ Â§  QA coerÃªncia     â–“
â• â–ˆâ–€â–ˆ  SEL0 DUAL
â•šâ•â• âˆ  â˜†å½¡`,
  "Arte Neon Tribal": `â•”â•â•—  #ROOT:KODUX
â”‚ â—  DUAL on     â—‡ ValidadorPrompt
â”‚ Â§  QA          â–’  â˜†å½¡
â• â–ˆâ–€â–ˆ
â•šâ•â• âˆ`,
  "Copy Comercial": `â•”â•â•—  #ROOT:KODUX
â”‚ âŠ™  OBJ: conversÃ£o direta
â”‚ Â§  QA     â–’   â–ˆâ–€â–ˆ
â•šâ•â• âˆ  â˜†å½¡`,
  "Roteiro Curta": `â•”â•â•—  #ROOT:KODUX
â”‚ â–³  TÃ©cnica / SÃ­mbolo / PrÃ¡tica
â”‚ Â§  QA     â–“   â˜†å½¡
â• â–ˆâ–€â–ˆ
â•šâ•â• âˆ`,
  "MÃºsica Club Noturna": `â•”â•â•—  #ROOT:KODUX
â”‚ â—  DUAL on   â–“
â”‚ Â§  QA        â–ˆâ–€â–ˆ
â•šâ•â• âˆ  â˜†å½¡`,
  "PÃ´ster Sciâ€‘Fi Retro": `â•”â•â•—  #ROOT:KODUX
â”‚ âŠ™   â–’  â˜†å½¡
â”‚ Â§  QA
â•šâ•â• âˆ  â–ˆâ–€â–ˆ`,
  "LanÃ§amento RelÃ¢mpago": `â•”â•â•—  #ROOT:KODUX
â”‚ âŠ™  call-to-action    â–‘
â”‚ Â§  QA
â•šâ•â• âˆ  â–ˆâ–€â–ˆ`,
  "Storyboard Teaser 30s": `â•”â•â•—  #ROOT:KODUX
â”‚ â–³  tÃ©cnica/simbÃ³lica/prÃ¡tica  â–’
â”‚ Â§  QA
â•šâ•â• âˆ  â˜†å½¡`
};

const topicPresets = [
  "trilha mÃ­stica com tambores e sintetizadores",
  "pÃ´ster sciâ€‘fi retro com tipografia bold",
  "copy de lanÃ§amento para app de mÃºsica",
  "roteiro de curta de ficÃ§Ã£o urbana",
  "arte neon tribal para flyer de evento",
  "identidade visual minimalista para marca pessoal"
];
const stylePresets = [
  "neon tribal", "cinematogrÃ¡fico", "minimalista", "editorial premium",
  "vaporwave sujo", "orgÃ¢nico-sintÃ©tico", "technoir"
];
const audPresets = [
  "pÃºblico geral", "criadores", "produtores musicais", "DJs", "diretores de arte", "leitores de nÃ£o-ficÃ§Ã£o"
];
const extraPresets = [
  "evitar clichÃªs", "usar linguagem inclusiva", "16:9", "120-128 BPM",
  "key D minor", "granulaÃ§Ã£o leve e glow suave", "CTA claro em 12 palavras"
];
const comboPresets = [
  {name:"MÃºsica Ritual Neon", frame:"MÃºsica Ritual", topic:topicPresets[0], style:"neon tribal", aud:"produtores musicais", extras:"120-128 BPM; key D minor; evitar clichÃªs"},
  {name:"Poster Sciâ€‘Fi Bold", frame:"PÃ´ster Sciâ€‘Fi Retro", topic:topicPresets[1], style:"editorial premium", aud:"diretores de arte", extras:"16:9; granulaÃ§Ã£o leve e glow suave"},
  {name:"Copy RelÃ¢mpago App", frame:"LanÃ§amento RelÃ¢mpago", topic:topicPresets[2], style:"minimalista", aud:"pÃºblico geral", extras:"CTA claro em 12 palavras; usar linguagem inclusiva"},
  {name:"Roteiro Curta Urbana", frame:"Roteiro Curta", topic:topicPresets[3], style:"cinematogrÃ¡fico", aud:"leitores de nÃ£o-ficÃ§Ã£o", extras:"evitar clichÃªs; estruturar em 5 cenas"},
  {name:"Flyer Neon Tribal", frame:"Arte Neon Tribal", topic:topicPresets[4], style:"neon tribal", aud:"criadores", extras:"16:9; glow suave; contraste alto"}
];

function renderChips(container, items, onClick){
  const el = $(container); el.innerHTML = "";
  items.forEach(v => {
    const div = document.createElement("span");
    div.className = "chip";
    div.textContent = (v.name || v);
    div.addEventListener("click", ()=> onClick(v));
    el.appendChild(div);
  });
}

function setFramePreset(name){
  const txt = frameLibrary[name];
  if(!txt) return;
  $("#frame").value = txt;
  autoResize($("#frame"));
  toast("Preset de frame aplicado: "+name);
}

function applyFieldPreset(fieldId, value){
  const el = $(fieldId);
  if(el.tagName === "INPUT"){
    if(!el.value) el.value = value;
    else el.value = value; // substitui (mais prÃ¡tico no mobile)
  } else {
    // textarea extras: concatena com ; se jÃ¡ existir
    el.value = el.value ? (el.value.replace(/\s*;?\s*$/, '') + "; " + value) : value;
  }
  el.focus();
}

function applyComboPreset(p){
  setFramePreset(p.frame);
  $("#topic").value = p.topic;
  $("#style").value = p.style;
  $("#aud").value = p.aud;
  $("#extras").value = p.extras;
  ["#topic","#style","#aud","#extras","#frame"].forEach(sel => {
    const el = $(sel); if(el.tagName==="TEXTAREA") autoResize(el);
  });
  toast("Combo preset aplicado: "+p.name);
}

// Render presets
(function initPresets(){
  // Frames
  const fbar = $("#framePresets");
  fbar.innerHTML = "";
  Object.keys(frameLibrary).forEach(name=>{
    const b = document.createElement("span");
    b.className="chip"; b.textContent = name;
    b.addEventListener("click", ()=> setFramePreset(name));
    fbar.appendChild(b);
  });
  renderChips("#topicPresets", topicPresets, v => applyFieldPreset("#topic", v));
  renderChips("#stylePresets", stylePresets, v => applyFieldPreset("#style", v));
  renderChips("#audPresets", audPresets, v => applyFieldPreset("#aud", v));
  renderChips("#extraPresets", extraPresets, v => applyFieldPreset("#extras", v));
  renderChips("#comboPresets", comboPresets, applyComboPreset);
})();

// Symbol palette
$("#symbar").addEventListener("click", e=>{
  const b = e.target.closest(".sym"); if(!b) return;
  insertAtCursor($("#frame"), b.dataset.sym);
});

// Help modal
$("#btnHelp").onclick = ()=> $("#help").style.display="flex";
$("#btnCloseHelp").onclick = ()=> $("#help").style.display="none";

// Pre-fills
$("#btnUNO").onclick = ()=> setFramePreset("Copy Comercial");
$("#btnDUAL").onclick = ()=> setFramePreset("Arte Neon Tribal");
$("#btnTRI").onclick = ()=> setFramePreset("MÃºsica Ritual");

// Import/Export
$("#btnImport").onclick = ()=> $("#fileIn").click();
$("#fileIn").addEventListener("change", ev=>{
  const f = ev.target.files?.[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=> { $("#frame").value = String(reader.result||""); autoResize($("#frame")); toast("Frame importado"); };
  reader.readAsText(f);
});
$("#btnExport").onclick = ()=>{
  const blob = new Blob([$("#frame").value], {type:"text/plain;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "frame_portal.txt";
  a.click(); URL.revokeObjectURL(a.href);
};

// Copy buttons
$$("[data-copy]").forEach(btn=> btn.addEventListener("click", ()=>{
  const target = $(btn.dataset.copy);
  target.select(); document.execCommand("copy"); toast();
}));

// Clear
$("#btnClear").onclick = ()=>{
  $("#frame").value=""; $("#topic").value=""; $("#style").value=""; $("#aud").value=""; $("#extras").value="";
  ["#outText","#outImage","#outMusic","#outSelo"].forEach(id=> $(id).value="");
  toast("Limpou");
};

// Parser & Builders
function parseFrame(txt){
  const has = (s)=> txt.includes(s);
  const mode = has('â–³') ? 'TRINITY' : (has('â‡„') || has('â—')) ? 'DUAL' : has('âŠ™') ? 'UNO' : 'UNO';
  const density = has('â–“') ? 'alta' : has('â–’') ? 'mÃ©dia' : has('â–‘') ? 'baixa' : 'mÃ©dia';
  const beauty = (txt.includes('â˜†') || txt.includes('â˜†å½¡'));
  const force = txt.includes('â–ˆâ–€â–ˆ');
  const api = has('â—‡');
  const qa = has('Â§') || $("#qaOn").checked;
  const safe = has('âˆ') || $("#safeOn").checked;
  const root = has('#'); const minisrv = txt.includes('ğŸ’ '); const portal = (has('â•”â•â•—')||has('â•šâ•â•')||has('â”‚'));
  const densLevel = has('â–“')?3:has('â–’')?2:1;
  return { mode, density, densLevel, beauty, force, api, qa, safe, root, minisrv, portal };
}
function miniPortal(frame){
  let out = frame.replace(/[ \t]+/g,' ').trim().split('\n').slice(0,3).join(' ');
  if(out.length>120) out = out.slice(0,117)+'â€¦'; return out;
}
function seloDual(meta){
  const now = new Date();
  return `[SELO DUAL]
Autor: VocÃª + Dual Infodose
Portal: ${miniPortal($("#frame").value)}
Story: ${meta.mode} â€¢ densidade ${meta.density}${meta.beauty?' â€¢ estÃ©tica on':''}${meta.force?' â€¢ forÃ§a on':''}
ProveniÃªncia: Ultimate Finale HTML offline; IntegraÃ§Ãµes: ${meta.api?'marcadas (â—‡)':'nenhuma'}; QA: ${meta.qa?'on':'off'}; Safe: ${meta.safe?'on':'off'}
SessÃ£o: ${now.toISOString()}`;
}
function buildPrompts(meta, topic, style, aud, extras, toggles){
  const wordTarget = meta.densLevel===1? "breve, direto" : meta.densLevel===2? "equilÃ­brio entre profundidade e concisÃ£o" : "detalhado, rico em nuances";
  const imgDetail = meta.densLevel===1? "clean, composiÃ§Ã£o simples" : meta.densLevel===2? "composiÃ§Ã£o equilibrada e camadas de detalhe" : "composiÃ§Ã£o complexa, mÃºltiplos planos e microdetalhes";
  const musicDetail = meta.densLevel===1? "estrutura simples 8/16 bars" : meta.densLevel===2? "estrutura 32/64 bars" : "estrutura 64+ bars com variaÃ§Ãµes e breaks";
  const vibe=[];
  if(meta.beauty) vibe.push("estÃ©tica elevada (â˜†å½¡)");
  if(meta.force) vibe.push("intensidade e impacto (â–ˆâ–€â–ˆ)");
  if(toggles.cabX) vibe.push("paleta neon tribal (Cabelos X)");
  if(toggles.cabY) vibe.push("organizaÃ§Ã£o tÃ©cnica e precisÃ£o (Cabelos Y)");
  if(toggles.cabZ) vibe.push("fluidez onÃ­rica e transiÃ§Ãµes suaves (Cabelos Z)");
  const vibeLine = vibe.length? `EstÃ©tica: ${vibe.join(', ')}.` : "";
  let textPrompt="", imagePrompt="", musicPrompt="";
  if(meta.mode==='UNO'){
    textPrompt = `Escreva sobre: "${topic}". PÃºblico: ${aud||"geral"}. Estilo: ${style||"claro e envolvente"}.
Objetivo: entregar conteÃºdo ${wordTarget} com orientaÃ§Ã£o prÃ¡tica.
${meta.qa? "Mantenha coerÃªncia, evite contradiÃ§Ãµes.": ""}
${vibeLine}
Extras: ${extras||"nenhum"}.
SaÃ­da pedida: texto final pronto para uso.`.trim();
    imagePrompt = `Crie uma descriÃ§Ã£o de imagem para: "${topic}". Estilo: ${style||"contemporÃ¢neo"}.
Diretrizes: ${imgDetail}. Foco em clareza do assunto principal.
${vibeLine}
Extras: ${extras||"nenhum"}.
Formato sugerido: 16:9 (adaptÃ¡vel).`.trim();
    musicPrompt = `Crie um prompt de mÃºsica para: "${topic}". PÃºblico: ${aud||"amplo"}. Estilo: ${style||"cinematogrÃ¡fico / eletrÃ´nico orgÃ¢nico"}.
Diretrizes: ${musicDetail}. Estrutura clara de introduÃ§Ã£o, desenvolvimento e fechamento.
${vibeLine}
Extras (BPM/tonalidade/tema): ${extras||"BPM livre, tonalidade a definir"}.`.trim();
  } else if(meta.mode==='DUAL'){
    textPrompt = `Produza um texto em duas perspectivas (DUAL) sobre: "${topic}". PÃºblico: ${aud||"geral"}. Estilo: ${style||"equilibrado e persuasivo"}.
Camada A: visÃ£o tÃ©cnica/objetiva. Camada B: visÃ£o criativa/narrativa. ConvergÃªncia ao final (sÃ­ntese prÃ¡tica).
${meta.qa? "Valide coerÃªncia entre as duas camadas (Â§).": ""}
${vibeLine}
Extras: ${extras||"nenhum"}.
SaÃ­da: texto final com seÃ§Ãµes A/B + sÃ­ntese.`.trim();
    imagePrompt = `Descreva uma imagem DUAL sobre "${topic}": contraponha dois elementos/estÃ©ticas e una-os numa composiÃ§Ã£o ${imgDetail}.
Estilo: ${style||"hÃ­brido tÃ©cnico-criativo"}. ${vibeLine}
Extras: ${extras||"nenhum"}.
Indique luz, enquadramento, textura e pÃ³s-processo.`.trim();
    musicPrompt = `Gere um prompt musical DUAL para "${topic}", combinando duas identidades (A e B) que convergem no drop/outro.
Estilo: ${style||"hÃ­brido"}; ${musicDetail}. ${vibeLine}
Defina BPM aproximado, timbres-chave e progressÃµes.
Extras: ${extras||"nenhum"}.`.trim();
  } else { // TRINITY
    textPrompt = `Crie um texto em TRINITY para "${topic}" (PÃºblico: ${aud||"geral"}, Estilo: ${style||"elegante e claro"}):
1) Camada tÃ©cnica/explicativa,
2) Camada simbÃ³lica/analÃ³gica,
3) Camada prÃ¡tica/aplicaÃ§Ã£o.
${meta.qa? "Garanta coerÃªncia entre as camadas (Â§).": ""}
${vibeLine}
Diretriz de densidade: ${wordTarget}. Extras: ${extras||"nenhum"}.`.trim();
    imagePrompt = `Descreva uma imagem TRINITY para "${topic}":
- TÃ©cnica: materiais, luz, lente, composiÃ§Ã£o (${imgDetail}).
- SimbÃ³lica: metÃ¡foras visuais e Ã­cones.
- PrÃ¡tica: uso/aplicaÃ§Ã£o e legibilidade.
Estilo: ${style||"alto impacto editorial"}. ${vibeLine}
Extras: ${extras||"nenhum"}.`.trim();
    musicPrompt = `Elabore um prompt musical TRINITY para "${topic}":
1) TÃ©cnica: BPM, key, escala, instrumentos, estrutura (${musicDetail}).
2) SimbÃ³lica: motivo/tema e clima emocional.
3) PrÃ¡tica: contexto de uso, duraÃ§Ã£o e transiÃ§Ãµes.
Estilo: ${style||"orgÃ¢nico-sintÃ©tico"}. ${vibeLine}
Extras: ${extras||"nenhum"}.`.trim();
  }
  return {textPrompt, imagePrompt, musicPrompt};
}

function buildFullMD(meta, topic, style, aud, extras, prompts){
  return `# Ultimate Finale â€” SaÃ­da

**Modo:** ${meta.mode}  
**Densidade:** ${meta.density}  
**EstÃ©tica:** ${(meta.beauty?'on':'off')}  
**ForÃ§a:** ${(meta.force?'on':'off')}  
**IntegraÃ§Ãµes (â—‡):** ${(meta.api?'marcadas':'nÃ£o marcadas')}  
**QA (Â§):** ${(meta.qa?'on':'off')}  
**Safe (âˆ):** ${(meta.safe?'on':'off')}  
**Tema:** ${topic||'-'}  
**Estilo:** ${style||'-'}  
**AudiÃªncia:** ${aud||'-'}  
**Extras:** ${extras||'-'}  

## ğŸ“ Texto

${prompts.textPrompt}

## ğŸ–¼ï¸ Imagem

${prompts.imagePrompt}

## ğŸµ MÃºsica

${prompts.musicPrompt}

## ğŸ”– Selo Dual

${seloDual(meta)}
`;
}

// Generate
$("#btnGenerate").onclick = ()=>{
  const meta = parseFrame($("#frame").value);
  const toggles = { cabX: $("#cabX").checked, cabY: $("#cabY").checked, cabZ: $("#cabZ").checked };
  const topic = $("#topic").value.trim();
  const style = $("#style").value.trim();
  const aud = $("#aud").value.trim();
  const extras = $("#extras").value.trim();
  const prompts = buildPrompts(meta, topic, style, aud, extras, toggles);
  $("#outText").value = prompts.textPrompt; autoResize($("#outText"));
  $("#outImage").value = prompts.imagePrompt; autoResize($("#outImage"));
  $("#outMusic").value = prompts.musicPrompt; autoResize($("#outMusic"));
  $("#outSelo").value = seloDual(meta); autoResize($("#outSelo"));
  toast("Prompts gerados âš¡");
};

// Downloads
$("#btnDownloadMD").onclick = ()=>{
  const meta = parseFrame($("#frame").value);
  const topic = $("#topic").value.trim();
  const style = $("#style").value.trim();
  const aud = $("#aud").value.trim();
  const extras = $("#extras").value.trim();
  const toggles = { cabX: $("#cabX").checked, cabY: $("#cabY").checked, cabZ: $("#cabZ").checked };
  const prompts = {
    textPrompt: $("#outText").value || buildPrompts(meta, topic, style, aud, extras, toggles).textPrompt,
    imagePrompt: $("#outImage").value || buildPrompts(meta, topic, style, aud, extras, toggles).imagePrompt,
    musicPrompt: $("#outMusic").value || buildPrompts(meta, topic, style, aud, extras, toggles).musicPrompt
  };
  const md = buildFullMD(meta, topic, style, aud, extras, prompts);
  const blob = new Blob([md], {type:"text/markdown;charset=utf-8"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "ultimate_finale_FULL.md"; a.click();
  URL.revokeObjectURL(a.href);
};
$("#btnDownloadJSON").onclick = ()=>{
  const meta = parseFrame($("#frame").value);
  const data = {
    meta, input:{ frame: $("#frame").value, topic: $("#topic").value, style: $("#style").value, aud: $("#aud").value, extras: $("#extras").value },
    outputs:{ text: $("#outText").value, image: $("#outImage").value, music: $("#outMusic").value, selo: $("#outSelo").value }
  };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "ultimate_finale_data.json"; a.click();
  URL.revokeObjectURL(a.href);
};

// Auto-resize on input
["#frame","#outText","#outImage","#outMusic","#outSelo","#extras"].forEach(sel=>{
  const el = $(sel);
  el.addEventListener("input", ()=> autoResize(el));
  autoResize(el);
});
</script>

<footer class="footer">
  Ultimate Finale â€¢ Standalone HTML (presets) â€¢ artes codex azure Â© â€¢ mobile-first (iPhone retrato).
</footer>
</body>
</html>
