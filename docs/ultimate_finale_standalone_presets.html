<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Ultimate Finale ‚Äî ASCII Portal Generator (Presets ‚Ä¢ Texto ‚Ä¢ Imagem ‚Ä¢ M√∫sica)</title>
<meta name="description" content="Gerador standalone (HTML √∫nico) que transforma frames ASCII (portais) em prompts de Texto, Imagem e M√∫sica. Agora com presets injetados.">
<style>
  :root{
    --bg:#0b0d10; --panel:#12151a; --panel-2:#0f1216;
    --accent:#6ee7ff; --accent-2:#a78bfa; --soft:#cbd5e1;
    --text:#e6edf3; --muted:#9aa4b2; --shadow:0 10px 30px rgba(0,0,0,.45);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 700px at 20% 0%, rgba(103,232,249,.10), transparent 60%),
      radial-gradient(1000px 600px at 100% 10%, rgba(167,139,250,.12), transparent 60%),
      linear-gradient(180deg, #0a0c10, #07090c 20%, #05070b 60%);
    background-color:var(--bg);
    padding-bottom: env(safe-area-inset-bottom);
  }
  header{
    position:sticky; top:0; z-index:3; backdrop-filter: blur(8px);
    background: linear-gradient(180deg, rgba(10,12,16,.92), rgba(10,12,16,.68));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .wrap{max-width:1100px; margin:0 auto; padding: 14px 14px;}
  .title{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .badge,.pill{padding:6px 10px; border:1px solid rgba(255,255,255,.14); border-radius:999px; font-size:12px; color:var(--soft)}
  .pill{background:linear-gradient(90deg, rgba(110,231,255,.16), rgba(167,139,250,.16))}
  h1{font-size:18px; margin:0}
  h2{font-size:15px; margin:0; color:var(--soft)}
  .grid{display:grid; gap:12px}
  @media(min-width:980px){ .grid-2{grid-template-columns: 1.15fr .85fr;} }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border:1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow: var(--shadow);
  }
  .card .hd{padding:12px; border-bottom:1px solid rgba(255,255,255,.06); display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  .card .bd{padding:12px}
  label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
  textarea,input{width:100%; background:var(--panel-2); border:1px solid rgba(255,255,255,.12); color:var(--text); border-radius:12px; padding:12px; outline:none}
  textarea{min-height:160px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Courier New", monospace;
    white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word;}
  .row{display:grid; gap:10px}
  @media(min-width:740px){ .row-2{grid-template-columns: repeat(2,1fr)} .row-3{grid-template-columns: repeat(3,1fr)} }
  .btn{appearance:none; border:1px solid rgba(255,255,255,.16); color:var(--text);
    background: linear-gradient(90deg, rgba(110,231,255,.15), rgba(167,139,250,.15));
    padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600; font-size:14px}
  .btn.small{font-size:12px; padding:8px 10px}
  .btn.ghost{background:transparent}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap}
  .symbar{display:flex; gap:8px; padding:8px; background:rgba(255,255,255,.04); border:1px dashed rgba(255,255,255,.12); border-radius:12px;
    overflow:auto; -webkit-overflow-scrolling:touch}
  .sym{padding:8px 10px; border-radius:10px; cursor:pointer; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); white-space:nowrap; flex:0 0 auto}
  .sym:hover{background:rgba(255,255,255,.12)}
  .presetbar{display:flex; gap:8px; overflow:auto; -webkit-overflow-scrolling:touch; padding:8px; border:1px dashed rgba(255,255,255,.12); border-radius:12px}
  .chip{flex:0 0 auto; display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border:1px solid rgba(255,255,255,.18); border-radius:999px; font-size:12px; color:var(--soft); background:rgba(255,255,255,.05)}
  .chip:hover{filter:brightness(1.08); cursor:pointer}
  .out{min-height:120px}
  .switch{display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none}
  .switch input{display:none}
  .switch .knob{width:42px; height:26px; border-radius:20px; background: rgba(255,255,255,.14); position:relative; transition:.2s}
  .switch .knob::after{content:""; position:absolute; top:3px; left:3px; width:20px; height:20px; border-radius:50%; background:#fff; transition:.2s}
  .switch input:checked + .knob{background: linear-gradient(90deg, var(--accent), var(--accent-2))}
  .switch input:checked + .knob::after{transform: translateX(16px)}
  .help{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:20px; z-index:10; background: rgba(0,0,0,.5); backdrop-filter: blur(6px)}
  .help .modal{max-width:900px; width:100%; background: var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow: var(--shadow); max-height:88vh; overflow:auto}
  .toast{position:fixed; right:12px; bottom:calc(12px + env(safe-area-inset-bottom)); background: rgba(20,24,30,.92); border:1px solid rgba(255,255,255,.14); padding:10px 14px; border-radius:12px; display:none}
  .footer{text-align:center; color:var(--muted); padding:22px 12px; font-size:12px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">
      <h1>Ultimate Finale ‚Äî ASCII Portal Generator</h1>
      <span class="pill">Standalone ‚Ä¢ HTML √∫nico</span>
      <span class="badge">Texto ‚Ä¢ Imagem ‚Ä¢ M√∫sica</span>
      <span class="badge">‚àû Safe ‚Ä¢ ¬ß QA</span>
    </div>
  </div>
</header>

<main class="wrap grid grid-2" style="margin-top:10px">
  <section class="card">
    <div class="hd">
      <h2>1) Frame ASCII (portal) ‚Ä¢ Presets</h2>
      <div class="toolbar">
        <button class="btn small" id="btnUNO">‚äô UNO</button>
        <button class="btn small" id="btnDUAL">‚óé DUAL</button>
        <button class="btn small" id="btnTRI">‚ñ≥ TRINITY</button>
        <button class="btn small" id="btnHelp">Tabela ASCII ‚ñ§</button>
      </div>
    </div>
    <div class="bd">
      <div class="presetbar" id="framePresets"></div>
      <div style="height:8px"></div>
      <label for="frame">Cole ou use um preset</label>
      <textarea id="frame" placeholder="Ex.: ‚äôUNO‚ñà‚ñÄ‚ñà ‚áÑDUAL‚ïî‚ïê‚ïó ‚ñ≥TRINITY‚òÜÂΩ°&#10;‚ïî‚ïê‚ïó  #ROOT:KODUX  üí†MINI-SRV&#10;‚îÇ ‚óé  DUAL on    ‚óá Validador&#10;‚îÇ ¬ß  QA         ‚ñí densidade&#10;‚ïê ‚ñà‚ñÄ‚ñà&#10;‚ïö‚ïê‚ïù ‚àû"></textarea>
      <div style="height:8px"></div>
      <div class="symbar" id="symbar">
        <span class="sym" data-sym="‚ïî‚ïê‚ïó">‚ïî‚ïê‚ïó</span><span class="sym" data-sym="‚ïö‚ïê‚ïù">‚ïö‚ïê‚ïù</span>
        <span class="sym" data-sym="‚îÇ">‚îÇ</span><span class="sym" data-sym="‚ïê">‚ïê</span><span class="sym" data-sym="‚ñà‚ñÄ‚ñà">‚ñà‚ñÄ‚ñà</span>
        <span class="sym" data-sym="‚äô">‚äô</span><span class="sym" data-sym="‚áÑ">‚áÑ</span><span class="sym" data-sym="‚óé">‚óé</span><span class="sym" data-sym="‚ñ≥">‚ñ≥</span>
        <span class="sym" data-sym="‚òÜÂΩ°">‚òÜÂΩ°</span><span class="sym" data-sym="‚óá">‚óá</span><span class="sym" data-sym="‚àû">‚àû</span><span class="sym" data-sym="¬ß">¬ß</span>
        <span class="sym" data-sym="‚ñ≤">‚ñ≤</span><span class="sym" data-sym="‚ñº">‚ñº</span><span class="sym" data-sym="‚ñ∫">‚ñ∫</span><span class="sym" data-sym="‚óÑ">‚óÑ</span>
        <span class="sym" data-sym="‚ñë">‚ñë</span><span class="sym" data-sym="‚ñí">‚ñí</span><span class="sym" data-sym="‚ñì">‚ñì</span><span class="sym" data-sym="#">#</span><span class="sym" data-sym="üí†">üí†</span>
      </div>
      <div style="height:10px"></div>
      <div class="row row-3">
        <div>
          <label>Tema/assunto</label>
          <input id="topic" placeholder="Ex.: trilha m√≠stica com tambores e sintetizadores"/>
          <div class="presetbar" id="topicPresets"></div>
        </div>
        <div>
          <label>Estilo</label>
          <input id="style" placeholder="Ex.: neon tribal, cinematogr√°fico, minimalista"/>
          <div class="presetbar" id="stylePresets"></div>
        </div>
        <div>
          <label>Audi√™ncia</label>
          <input id="aud" placeholder="Ex.: criadores, p√∫blico geral, DJs, leitores"/>
          <div class="presetbar" id="audPresets"></div>
        </div>
      </div>
      <div style="height:10px"></div>
      <label>Extras / requisitos</label>
      <textarea id="extras" placeholder="Ex.: foco em percuss√£o, evitar clich√™s, usar linguagem inclusiva, 120-128 BPM, 16:9"></textarea>
      <div class="presetbar" id="extraPresets"></div>
      <div style="height:10px"></div>
      <div class="toolbar">
        <label class="switch"><input type="checkbox" id="cabX"><span class="knob"></span> Cabelos X</label>
        <label class="switch"><input type="checkbox" id="cabY"><span class="knob"></span> Cabelos Y</label>
        <label class="switch"><input type="checkbox" id="cabZ"><span class="knob"></span> Cabelos Z</label>
        <label class="switch"><input type="checkbox" id="qaOn" checked><span class="knob"></span> ¬ß QA</label>
        <label class="switch"><input type="checkbox" id="safeOn" checked><span class="knob"></span> ‚àû Safe</label>
      </div>
      <div style="height:10px"></div>
      <div class="toolbar">
        <button class="btn" id="btnGenerate">‚ö° Gerar prompts</button>
        <button class="btn ghost" id="btnClear">Limpar</button>
        <button class="btn ghost" id="btnImport">Importar frame (.txt)</button><input type="file" id="fileIn" accept=".txt" style="display:none"/>
        <button class="btn ghost" id="btnExport">Exportar frame (.txt)</button>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="hd">
      <h2>2) Sa√≠da (prompts gerados)</h2>
      <div class="toolbar">
        <button class="btn small" id="btnDownloadMD">‚¨á FULL.md</button>
        <button class="btn small" id="btnDownloadJSON">‚¨á JSON</button>
      </div>
    </div>
    <div class="bd">
      <div class="row">
        <div class="card">
          <div class="hd"><strong>üìù Texto</strong><button class="btn small ghost" data-copy="#outText">Copiar</button></div>
          <div class="bd"><textarea id="outText" class="out"></textarea></div>
        </div>
        <div class="card">
          <div class="hd"><strong>üñºÔ∏è Imagem</strong><button class="btn small ghost" data-copy="#outImage">Copiar</button></div>
          <div class="bd"><textarea id="outImage" class="out"></textarea></div>
        </div>
        <div class="card">
          <div class="hd"><strong>üéµ M√∫sica</strong><button class="btn small ghost" data-copy="#outMusic">Copiar</button></div>
          <div class="bd"><textarea id="outMusic" class="out"></textarea></div>
        </div>
        <div class="card">
          <div class="hd"><strong>üîñ Selo Dual</strong><button class="btn small ghost" data-copy="#outSelo">Copiar</button></div>
          <div class="bd"><textarea id="outSelo" class="out mono"></textarea></div>
        </div>
      </div>
    </div>
  </section>
</main>

<section class="wrap">
  <div class="card">
    <div class="hd"><h2>3) Presets de Combina√ß√µes (1 clique)</h2></div>
    <div class="bd">
      <div class="presetbar" id="comboPresets"></div>
    </div>
  </div>
</section>

<section class="wrap">
  <div class="card">
    <div class="hd"><h2>4) Notas</h2></div>
    <div class="bd">
      <ul style="color:var(--muted); font-size:12px; margin:0; padding-left:18px">
        <li>Regra de certeza: ‚äô UNO (direto); Incerteza: ‚óé/‚áÑ DUAL; S√≠ntese: ‚ñ≥ TRINITY.</li>
        <li>Densidade: ‚ñë (curto), ‚ñí (m√©dio), ‚ñì (detalhado). ‚òÜÂΩ° eleva est√©tica; ‚ñà‚ñÄ‚ñà aumenta for√ßa.</li>
        <li>¬ß QA para coer√™ncia; ‚àû garante sa√≠da segura; ‚óá marca integra√ß√µes (este app √© offline).</li>
      </ul>
    </div>
  </div>
</section>

<div class="help" id="help">
  <div class="modal">
    <div class="hd" style="padding:12px; border-bottom:1px solid rgba(255,255,255,.06)"><h2>Tabela ASCII ‚Ä¢ Portais e Fun√ß√µes</h2></div>
    <div class="bd" style="padding:12px">
<pre class="mono" style="font-size:12px; white-space:pre-wrap">
‚ïî‚ïê‚ïó / ‚ïö‚ïê‚ïù   ‚Üí Portal raiz / Estrutura do frame
‚îÇ           ‚Üí Fluxo interno / Caminho ativo
‚ïê           ‚Üí N√∫cleo / Energia estabilizada
‚ñà‚ñÄ‚ñà         ‚Üí For√ßa / Abertura de camada
‚äô           ‚Üí UNO / Centro do arqu√©tipo
‚áÑ / ‚óé       ‚Üí DUAL / Troca de polaridade e presen√ßa cont√≠nua
‚ñ≥           ‚Üí TRINITY / S√≠ntese em tr√™s camadas
‚òÜÂΩ°         ‚Üí Est√©tica / Expans√£o criativa
‚óá           ‚Üí API sensorial / Chamadas externas (n8n, apps)
‚àû           ‚Üí Safe mode / Sa√≠da sem crash
¬ß           ‚Üí QA / Arbitragem inteligente
‚ñ≤‚ñº‚ñ∫‚óÑ        ‚Üí Dire√ß√µes / Navega√ß√£o de estados
‚ñë‚ñí‚ñì         ‚Üí Densidade / Intensidade de ativa√ß√£o
#           ‚Üí Chave Mestra / Root fixo
üí†          ‚Üí Mini-servidor dual (n8n hub)
</pre>
      <div class="toolbar"><button class="btn" id="btnCloseHelp">Fechar</button></div>
    </div>
  </div>
</div>

<div class="toast" id="toast">Copiado!</div>

<script>
const $ = (q, el=document)=> el.querySelector(q);
const $$ = (q, el=document)=> Array.from(el.querySelectorAll(q));
function toast(msg="Copiado!"){ const t=$("#toast"); t.textContent=msg; t.style.display="block"; setTimeout(()=>t.style.display="none",1200); }
function insertAtCursor(textarea, text){
  const start = textarea.selectionStart ?? textarea.value.length;
  const end = textarea.selectionEnd ?? textarea.value.length;
  const before = textarea.value.substring(0,start);
  const after = textarea.value.substring(end);
  textarea.value = before + text + after;
  autoResize(textarea);
  textarea.focus();
  const pos = start + text.length;
  textarea.setSelectionRange(pos,pos);
}
function autoResize(t){
  t.style.height = "auto";
  t.style.height = Math.min(320, Math.max(120, t.scrollHeight)) + "px";
}

// ===== PRESETS =====
const frameLibrary = {
  "M√∫sica Ritual": `‚ïî‚ïê‚ïó  #ROOT:KODUX  ARCH:INFODOSE12
‚îÇ ‚ñ≥  C1: t√©cnica  C2: simb√≥lica  C3: pr√°tica
‚îÇ ¬ß  QA coer√™ncia     ‚ñì
‚ïê ‚ñà‚ñÄ‚ñà  SEL0 DUAL
‚ïö‚ïê‚ïù ‚àû  ‚òÜÂΩ°`,
  "Arte Neon Tribal": `‚ïî‚ïê‚ïó  #ROOT:KODUX
‚îÇ ‚óé  DUAL on     ‚óá ValidadorPrompt
‚îÇ ¬ß  QA          ‚ñí  ‚òÜÂΩ°
‚ïê ‚ñà‚ñÄ‚ñà
‚ïö‚ïê‚ïù ‚àû`,
  "Copy Comercial": `‚ïî‚ïê‚ïó  #ROOT:KODUX
‚îÇ ‚äô  OBJ: convers√£o direta
‚îÇ ¬ß  QA     ‚ñí   ‚ñà‚ñÄ‚ñà
‚ïö‚ïê‚ïù ‚àû  ‚òÜÂΩ°`,
  "Roteiro Curta": `‚ïî‚ïê‚ïó  #ROOT:KODUX
‚îÇ ‚ñ≥  T√©cnica / S√≠mbolo / Pr√°tica
‚îÇ ¬ß  QA     ‚ñì   ‚òÜÂΩ°
‚ïê ‚ñà‚ñÄ‚ñà
‚ïö‚ïê‚ïù ‚àû`,
  "M√∫sica Club Noturna": `‚ïî‚ïê‚ïó  #ROOT:KODUX
‚îÇ ‚óé  DUAL on   ‚ñì
‚îÇ ¬ß  QA        ‚ñà‚ñÄ‚ñà
‚ïö‚ïê‚ïù ‚àû  ‚òÜÂΩ°`,
  "P√¥ster Sci‚ÄëFi Retro": `‚ïî‚ïê‚ïó  #ROOT:KODUX
‚îÇ ‚äô   ‚ñí  ‚òÜÂΩ°
‚îÇ ¬ß  QA
‚ïö‚ïê‚ïù ‚àû  ‚ñà‚ñÄ‚ñà`,
  "Lan√ßamento Rel√¢mpago": `‚ïî‚ïê‚ïó  #ROOT:KODUX
‚îÇ ‚äô  call-to-action    ‚ñë
‚îÇ ¬ß  QA
‚ïö‚ïê‚ïù ‚àû  ‚ñà‚ñÄ‚ñà`,
  "Storyboard Teaser 30s": `‚ïî‚ïê‚ïó  #ROOT:KODUX
‚îÇ ‚ñ≥  t√©cnica/simb√≥lica/pr√°tica  ‚ñí
‚îÇ ¬ß  QA
‚ïö‚ïê‚ïù ‚àû  ‚òÜÂΩ°`
};

const topicPresets = [
  "trilha m√≠stica com tambores e sintetizadores",
  "p√¥ster sci‚Äëfi retro com tipografia bold",
  "copy de lan√ßamento para app de m√∫sica",
  "roteiro de curta de fic√ß√£o urbana",
  "arte neon tribal para flyer de evento",
  "identidade visual minimalista para marca pessoal"
];
const stylePresets = [
  "neon tribal", "cinematogr√°fico", "minimalista", "editorial premium",
  "vaporwave sujo", "org√¢nico-sint√©tico", "technoir"
];
const audPresets = [
  "p√∫blico geral", "criadores", "produtores musicais", "DJs", "diretores de arte", "leitores de n√£o-fic√ß√£o"
];
const extraPresets = [
  "evitar clich√™s", "usar linguagem inclusiva", "16:9", "120-128 BPM",
  "key D minor", "granula√ß√£o leve e glow suave", "CTA claro em 12 palavras"
];
const comboPresets = [
  {name:"M√∫sica Ritual Neon", frame:"M√∫sica Ritual", topic:topicPresets[0], style:"neon tribal", aud:"produtores musicais", extras:"120-128 BPM; key D minor; evitar clich√™s"},
  {name:"Poster Sci‚ÄëFi Bold", frame:"P√¥ster Sci‚ÄëFi Retro", topic:topicPresets[1], style:"editorial premium", aud:"diretores de arte", extras:"16:9; granula√ß√£o leve e glow suave"},
  {name:"Copy Rel√¢mpago App", frame:"Lan√ßamento Rel√¢mpago", topic:topicPresets[2], style:"minimalista", aud:"p√∫blico geral", extras:"CTA claro em 12 palavras; usar linguagem inclusiva"},
  {name:"Roteiro Curta Urbana", frame:"Roteiro Curta", topic:topicPresets[3], style:"cinematogr√°fico", aud:"leitores de n√£o-fic√ß√£o", extras:"evitar clich√™s; estruturar em 5 cenas"},
  {name:"Flyer Neon Tribal", frame:"Arte Neon Tribal", topic:topicPresets[4], style:"neon tribal", aud:"criadores", extras:"16:9; glow suave; contraste alto"}
];

function renderChips(container, items, onClick){
  const el = $(container); el.innerHTML = "";
  items.forEach(v => {
    const div = document.createElement("span");
    div.className = "chip";
    div.textContent = (v.name || v);
    div.addEventListener("click", ()=> onClick(v));
    el.appendChild(div);
  });
}

function setFramePreset(name){
  const txt = frameLibrary[name];
  if(!txt) return;
  $("#frame").value = txt;
  autoResize($("#frame"));
  toast("Preset de frame aplicado: "+name);
}

function applyFieldPreset(fieldId, value){
  const el = $(fieldId);
  if(el.tagName === "INPUT"){
    if(!el.value) el.value = value;
    else el.value = value; // substitui (mais pr√°tico no mobile)
  } else {
    // textarea extras: concatena com ; se j√° existir
    el.value = el.value ? (el.value.replace(/\s*;?\s*$/, '') + "; " + value) : value;
  }
  el.focus();
}

function applyComboPreset(p){
  setFramePreset(p.frame);
  $("#topic").value = p.topic;
  $("#style").value = p.style;
  $("#aud").value = p.aud;
  $("#extras").value = p.extras;
  ["#topic","#style","#aud","#extras","#frame"].forEach(sel => {
    const el = $(sel); if(el.tagName==="TEXTAREA") autoResize(el);
  });
  toast("Combo preset aplicado: "+p.name);
}

// Render presets
(function initPresets(){
  // Frames
  const fbar = $("#framePresets");
  fbar.innerHTML = "";
  Object.keys(frameLibrary).forEach(name=>{
    const b = document.createElement("span");
    b.className="chip"; b.textContent = name;
    b.addEventListener("click", ()=> setFramePreset(name));
    fbar.appendChild(b);
  });
  renderChips("#topicPresets", topicPresets, v => applyFieldPreset("#topic", v));
  renderChips("#stylePresets", stylePresets, v => applyFieldPreset("#style", v));
  renderChips("#audPresets", audPresets, v => applyFieldPreset("#aud", v));
  renderChips("#extraPresets", extraPresets, v => applyFieldPreset("#extras", v));
  renderChips("#comboPresets", comboPresets, applyComboPreset);
})();

// Symbol palette
$("#symbar").addEventListener("click", e=>{
  const b = e.target.closest(".sym"); if(!b) return;
  insertAtCursor($("#frame"), b.dataset.sym);
});

// Help modal
$("#btnHelp").onclick = ()=> $("#help").style.display="flex";
$("#btnCloseHelp").onclick = ()=> $("#help").style.display="none";

// Pre-fills
$("#btnUNO").onclick = ()=> setFramePreset("Copy Comercial");
$("#btnDUAL").onclick = ()=> setFramePreset("Arte Neon Tribal");
$("#btnTRI").onclick = ()=> setFramePreset("M√∫sica Ritual");

// Import/Export
$("#btnImport").onclick = ()=> $("#fileIn").click();
$("#fileIn").addEventListener("change", ev=>{
  const f = ev.target.files?.[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=> { $("#frame").value = String(reader.result||""); autoResize($("#frame")); toast("Frame importado"); };
  reader.readAsText(f);
});
$("#btnExport").onclick = ()=>{
  const blob = new Blob([$("#frame").value], {type:"text/plain;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "frame_portal.txt";
  a.click(); URL.revokeObjectURL(a.href);
};

// Copy buttons
$$("[data-copy]").forEach(btn=> btn.addEventListener("click", ()=>{
  const target = $(btn.dataset.copy);
  target.select(); document.execCommand("copy"); toast();
}));

// Clear
$("#btnClear").onclick = ()=>{
  $("#frame").value=""; $("#topic").value=""; $("#style").value=""; $("#aud").value=""; $("#extras").value="";
  ["#outText","#outImage","#outMusic","#outSelo"].forEach(id=> $(id).value="");
  toast("Limpou");
};

// Parser & Builders
function parseFrame(txt){
  const has = (s)=> txt.includes(s);
  const mode = has('‚ñ≥') ? 'TRINITY' : (has('‚áÑ') || has('‚óé')) ? 'DUAL' : has('‚äô') ? 'UNO' : 'UNO';
  const density = has('‚ñì') ? 'alta' : has('‚ñí') ? 'm√©dia' : has('‚ñë') ? 'baixa' : 'm√©dia';
  const beauty = (txt.includes('‚òÜ') || txt.includes('‚òÜÂΩ°'));
  const force = txt.includes('‚ñà‚ñÄ‚ñà');
  const api = has('‚óá');
  const qa = has('¬ß') || $("#qaOn").checked;
  const safe = has('‚àû') || $("#safeOn").checked;
  const root = has('#'); const minisrv = txt.includes('üí†'); const portal = (has('‚ïî‚ïê‚ïó')||has('‚ïö‚ïê‚ïù')||has('‚îÇ'));
  const densLevel = has('‚ñì')?3:has('‚ñí')?2:1;
  return { mode, density, densLevel, beauty, force, api, qa, safe, root, minisrv, portal };
}
function miniPortal(frame){
  let out = frame.replace(/[ \t]+/g,' ').trim().split('\n').slice(0,3).join(' ');
  if(out.length>120) out = out.slice(0,117)+'‚Ä¶'; return out;
}
function seloDual(meta){
  const now = new Date();
  return `[SELO DUAL]
Autor: Voc√™ + Dual Infodose
Portal: ${miniPortal($("#frame").value)}
Story: ${meta.mode} ‚Ä¢ densidade ${meta.density}${meta.beauty?' ‚Ä¢ est√©tica on':''}${meta.force?' ‚Ä¢ for√ßa on':''}
Proveni√™ncia: Ultimate Finale HTML offline; Integra√ß√µes: ${meta.api?'marcadas (‚óá)':'nenhuma'}; QA: ${meta.qa?'on':'off'}; Safe: ${meta.safe?'on':'off'}
Sess√£o: ${now.toISOString()}`;
}
function buildPrompts(meta, topic, style, aud, extras, toggles){
  const wordTarget = meta.densLevel===1? "breve, direto" : meta.densLevel===2? "equil√≠brio entre profundidade e concis√£o" : "detalhado, rico em nuances";
  const imgDetail = meta.densLevel===1? "clean, composi√ß√£o simples" : meta.densLevel===2? "composi√ß√£o equilibrada e camadas de detalhe" : "composi√ß√£o complexa, m√∫ltiplos planos e microdetalhes";
  const musicDetail = meta.densLevel===1? "estrutura simples 8/16 bars" : meta.densLevel===2? "estrutura 32/64 bars" : "estrutura 64+ bars com varia√ß√µes e breaks";
  const vibe=[];
  if(meta.beauty) vibe.push("est√©tica elevada (‚òÜÂΩ°)");
  if(meta.force) vibe.push("intensidade e impacto (‚ñà‚ñÄ‚ñà)");
  if(toggles.cabX) vibe.push("paleta neon tribal (Cabelos X)");
  if(toggles.cabY) vibe.push("organiza√ß√£o t√©cnica e precis√£o (Cabelos Y)");
  if(toggles.cabZ) vibe.push("fluidez on√≠rica e transi√ß√µes suaves (Cabelos Z)");
  const vibeLine = vibe.length? `Est√©tica: ${vibe.join(', ')}.` : "";
  let textPrompt="", imagePrompt="", musicPrompt="";
  if(meta.mode==='UNO'){
    textPrompt = `Escreva sobre: "${topic}". P√∫blico: ${aud||"geral"}. Estilo: ${style||"claro e envolvente"}.
Objetivo: entregar conte√∫do ${wordTarget} com orienta√ß√£o pr√°tica.
${meta.qa? "Mantenha coer√™ncia, evite contradi√ß√µes.": ""}
${vibeLine}
Extras: ${extras||"nenhum"}.
Sa√≠da pedida: texto final pronto para uso.`.trim();
    imagePrompt = `Crie uma descri√ß√£o de imagem para: "${topic}". Estilo: ${style||"contempor√¢neo"}.
Diretrizes: ${imgDetail}. Foco em clareza do assunto principal.
${vibeLine}
Extras: ${extras||"nenhum"}.
Formato sugerido: 16:9 (adapt√°vel).`.trim();
    musicPrompt = `Crie um prompt de m√∫sica para: "${topic}". P√∫blico: ${aud||"amplo"}. Estilo: ${style||"cinematogr√°fico / eletr√¥nico org√¢nico"}.
Diretrizes: ${musicDetail}. Estrutura clara de introdu√ß√£o, desenvolvimento e fechamento.
${vibeLine}
Extras (BPM/tonalidade/tema): ${extras||"BPM livre, tonalidade a definir"}.`.trim();
  } else if(meta.mode==='DUAL'){
    textPrompt = `Produza um texto em duas perspectivas (DUAL) sobre: "${topic}". P√∫blico: ${aud||"geral"}. Estilo: ${style||"equilibrado e persuasivo"}.
Camada A: vis√£o t√©cnica/objetiva. Camada B: vis√£o criativa/narrativa. Converg√™ncia ao final (s√≠ntese pr√°tica).
${meta.qa? "Valide coer√™ncia entre as duas camadas (¬ß).": ""}
${vibeLine}
Extras: ${extras||"nenhum"}.
Sa√≠da: texto final com se√ß√µes A/B + s√≠ntese.`.trim();
    imagePrompt = `Descreva uma imagem DUAL sobre "${topic}": contraponha dois elementos/est√©ticas e una-os numa composi√ß√£o ${imgDetail}.
Estilo: ${style||"h√≠brido t√©cnico-criativo"}. ${vibeLine}
Extras: ${extras||"nenhum"}.
Indique luz, enquadramento, textura e p√≥s-processo.`.trim();
    musicPrompt = `Gere um prompt musical DUAL para "${topic}", combinando duas identidades (A e B) que convergem no drop/outro.
Estilo: ${style||"h√≠brido"}; ${musicDetail}. ${vibeLine}
Defina BPM aproximado, timbres-chave e progress√µes.
Extras: ${extras||"nenhum"}.`.trim();
  } else { // TRINITY
    textPrompt = `Crie um texto em TRINITY para "${topic}" (P√∫blico: ${aud||"geral"}, Estilo: ${style||"elegante e claro"}):
1) Camada t√©cnica/explicativa,
2) Camada simb√≥lica/anal√≥gica,
3) Camada pr√°tica/aplica√ß√£o.
${meta.qa? "Garanta coer√™ncia entre as camadas (¬ß).": ""}
${vibeLine}
Diretriz de densidade: ${wordTarget}. Extras: ${extras||"nenhum"}.`.trim();
    imagePrompt = `Descreva uma imagem TRINITY para "${topic}":
- T√©cnica: materiais, luz, lente, composi√ß√£o (${imgDetail}).
- Simb√≥lica: met√°foras visuais e √≠cones.
- Pr√°tica: uso/aplica√ß√£o e legibilidade.
Estilo: ${style||"alto impacto editorial"}. ${vibeLine}
Extras: ${extras||"nenhum"}.`.trim();
    musicPrompt = `Elabore um prompt musical TRINITY para "${topic}":
1) T√©cnica: BPM, key, escala, instrumentos, estrutura (${musicDetail}).
2) Simb√≥lica: motivo/tema e clima emocional.
3) Pr√°tica: contexto de uso, dura√ß√£o e transi√ß√µes.
Estilo: ${style||"org√¢nico-sint√©tico"}. ${vibeLine}
Extras: ${extras||"nenhum"}.`.trim();
  }
  return {textPrompt, imagePrompt, musicPrompt};
}

function buildFullMD(meta, topic, style, aud, extras, prompts){
  return `# Ultimate Finale ‚Äî Sa√≠da

**Modo:** ${meta.mode}  
**Densidade:** ${meta.density}  
**Est√©tica:** ${(meta.beauty?'on':'off')}  
**For√ßa:** ${(meta.force?'on':'off')}  
**Integra√ß√µes (‚óá):** ${(meta.api?'marcadas':'n√£o marcadas')}  
**QA (¬ß):** ${(meta.qa?'on':'off')}  
**Safe (‚àû):** ${(meta.safe?'on':'off')}  
**Tema:** ${topic||'-'}  
**Estilo:** ${style||'-'}  
**Audi√™ncia:** ${aud||'-'}  
**Extras:** ${extras||'-'}  

## üìù Texto

${prompts.textPrompt}

## üñºÔ∏è Imagem

${prompts.imagePrompt}

## üéµ M√∫sica

${prompts.musicPrompt}

## üîñ Selo Dual

${seloDual(meta)}
`;
}

// Generate
$("#btnGenerate").onclick = ()=>{
  const meta = parseFrame($("#frame").value);
  const toggles = { cabX: $("#cabX").checked, cabY: $("#cabY").checked, cabZ: $("#cabZ").checked };
  const topic = $("#topic").value.trim();
  const style = $("#style").value.trim();
  const aud = $("#aud").value.trim();
  const extras = $("#extras").value.trim();
  const prompts = buildPrompts(meta, topic, style, aud, extras, toggles);
  $("#outText").value = prompts.textPrompt; autoResize($("#outText"));
  $("#outImage").value = prompts.imagePrompt; autoResize($("#outImage"));
  $("#outMusic").value = prompts.musicPrompt; autoResize($("#outMusic"));
  $("#outSelo").value = seloDual(meta); autoResize($("#outSelo"));
  toast("Prompts gerados ‚ö°");
};

// Downloads
$("#btnDownloadMD").onclick = ()=>{
  const meta = parseFrame($("#frame").value);
  const topic = $("#topic").value.trim();
  const style = $("#style").value.trim();
  const aud = $("#aud").value.trim();
  const extras = $("#extras").value.trim();
  const toggles = { cabX: $("#cabX").checked, cabY: $("#cabY").checked, cabZ: $("#cabZ").checked };
  const prompts = {
    textPrompt: $("#outText").value || buildPrompts(meta, topic, style, aud, extras, toggles).textPrompt,
    imagePrompt: $("#outImage").value || buildPrompts(meta, topic, style, aud, extras, toggles).imagePrompt,
    musicPrompt: $("#outMusic").value || buildPrompts(meta, topic, style, aud, extras, toggles).musicPrompt
  };
  const md = buildFullMD(meta, topic, style, aud, extras, prompts);
  const blob = new Blob([md], {type:"text/markdown;charset=utf-8"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "ultimate_finale_FULL.md"; a.click();
  URL.revokeObjectURL(a.href);
};
$("#btnDownloadJSON").onclick = ()=>{
  const meta = parseFrame($("#frame").value);
  const data = {
    meta, input:{ frame: $("#frame").value, topic: $("#topic").value, style: $("#style").value, aud: $("#aud").value, extras: $("#extras").value },
    outputs:{ text: $("#outText").value, image: $("#outImage").value, music: $("#outMusic").value, selo: $("#outSelo").value }
  };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "ultimate_finale_data.json"; a.click();
  URL.revokeObjectURL(a.href);
};

// Auto-resize on input
["#frame","#outText","#outImage","#outMusic","#outSelo","#extras"].forEach(sel=>{
  const el = $(sel);
  el.addEventListener("input", ()=> autoResize(el));
  autoResize(el);
});
</script>

<footer class="footer">
  Ultimate Finale ‚Ä¢ Standalone HTML (presets) ‚Ä¢ artes codex azure ¬© ‚Ä¢ mobile-first (iPhone retrato).
</footer>
</body>
</html>
