<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>HTML Inspector & Editor — v2 Mobile</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f151c; --ink:#e8f0ff; --muted:#9fb3c8;
    --accent:#59c1ff; --accent2:#b17aff; --border:#1f2a36; --ok:#2ecc71; --warn:#ffbd2e; --err:#ff5c80;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  h1,h2,h3,h4,p{margin:0}
  .landing{display:flex;flex-direction:column;min-height:100%}
  .hero{padding:16px 16px 12px;background:linear-gradient(180deg,#0f141a,#0c1015);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:20}
  .title{font-size:16px;letter-spacing:.08em;margin-bottom:8px}
  .sub{font-size:12px;color:var(--muted)}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .btn{appearance:none;border:1px solid var(--border);background:var(--panel);color:var(--ink);
       padding:10px 12px;border-radius:12px;cursor:pointer;font-size:14px;min-height:44px}
  .btn.primary{background:linear-gradient(180deg,#13202b,#101820);border-color:#254156}
  .btn.ok{border-color:#164c2b;background:#0b2216}
  .btn.warn{border-color:#5a4100;background:#211a00}
  .btn:active{transform:translateY(1px)}
  .grid{display:flex;flex-direction:column;gap:12px;padding:12px}
  .card{border:1px solid var(--border);border-radius:14px;background:var(--panel);overflow:hidden}
  .card>header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#0f151c,#0f141a)}
  .card>header h3{font-size:13px;letter-spacing:.06em}
  .pill{border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted)}
  .section{padding:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .editor{width:100%;min-height:180px;max-height:50vh;overflow:auto;resize:vertical;background:#0b1015;color:#e8f0ff;border:1px solid #14202b;border-radius:12px;padding:12px 14px;font-family:var(--mono);font-size:13.5px;line-height:1.55;tab-size:2}
  .tabbar{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px}
  .tab{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#0d131a;font-size:12px;min-height:36px}
  .tab.active{border-color:#254156;background:#101a24}
  .tiny{font-size:11px;color:var(--muted)}
  .chip{border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-size:11px;color:var(--muted)}
  .toolbar{display:flex;gap:6px;flex-wrap:wrap}
  .toolbar .btn{min-height:36px;padding:6px 10px;font-size:12px}
  .field{display:flex;gap:6px}
  .field input{flex:1;min-width:120px;border:1px solid #14202b;background:#0b1015;color:#e8f0ff;border-radius:10px;padding:10px 12px;font-size:14px}
  .field .btn{min-width:44px}
  .stickybar{position:sticky;bottom:0;left:0;right:0;display:flex;gap:8px;justify-content:space-between;background:rgba(12,16,22,.8);backdrop-filter:blur(10px);border-top:1px solid var(--border);padding:10px 12px;z-index:30}
  .split{display:grid;gap:10px}
  .preview{width:100%;height:50vh;border:none;background:white;border:1px solid var(--border);border-radius:12px}
  .list{display:grid;gap:6px}
  .li{display:flex;gap:8px;justify-content:space-between;align-items:center;border:1px solid var(--border);border-radius:10px;padding:8px 10px;background:#0b1015}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  .mono{font-family:var(--mono)}
  .hint{color:#c7d7ea}
  .ghost{opacity:.6}
</style>
</head>
<body>
<div class="landing">
  <div class="hero">
    <div class="title">HTML Inspector & Editor — v2 (Mobile)</div>
    <div class="sub">Upload/colar, editar por partes, abas de CSS/JS, busca/replace, auto‑indent, preview e validação simples.</div>
    <div class="actions">
      <button class="btn" id="btnOpen">Abrir</button>
      <input type="file" id="fileInput" accept=".html,.htm,.txt" class="ghost" style="display:none"/>
      <button class="btn" id="btnPaste">Colar</button>
      <button class="btn" id="btnCopyAll">Copiar</button>
      <button class="btn ok" id="btnExport">Exportar</button>
    </div>
  </div>

  <div class="grid">
    <!-- HTML Pane -->
    <section class="card" id="paneHTML">
      <header>
        <h3>HTML</h3>
        <div class="toolbar">
          <button class="btn" data-action="undo" data-target="html">Desfazer</button>
          <button class="btn" data-action="redo" data-target="html">Refazer</button>
          <button class="btn" data-action="beautify" data-target="html">Auto‑indentar</button>
        </div>
      </header>
      <div class="section">
        <div class="field" style="margin-bottom:8px">
          <input id="findHTML" placeholder="Buscar no HTML"/>
          <input id="replHTML" placeholder="Substituir por"/>
          <button class="btn" data-find="html" data-op="prev">◀</button>
          <button class="btn" data-find="html" data-op="next">▶</button>
          <button class="btn" data-find="html" data-op="replace">Subst.</button>
          <button class="btn" data-find="html" data-op="replaceAll">Tudo</button>
        </div>
        <textarea class="editor" id="editorHTML" spellcheck="false" placeholder="Cole seu HTML aqui..."></textarea>
        <div class="tiny">Dica: cole um documento completo ou um trecho; a recomposição tratará CSS/JS inline.</div>
      </div>
    </section>

    <!-- CSS Pane with tabs -->
    <section class="card" id="paneCSS">
      <header>
        <h3>CSS (abas)</h3>
        <div class="toolbar">
          <button class="btn" id="btnAddStyle">+ Style</button>
        </div>
      </header>
      <div class="section">
        <div class="tabbar" id="tabsCSS"></div>
        <div class="field" style="margin-bottom:8px">
          <input id="findCSS" placeholder="Buscar no CSS"/>
          <input id="replCSS" placeholder="Substituir por"/>
          <button class="btn" data-find="css" data-op="prev">◀</button>
          <button class="btn" data-find="css" data-op="next">▶</button>
          <button class="btn" data-find="css" data-op="replace">Subst.</button>
          <button class="btn" data-find="css" data-op="replaceAll">Tudo</button>
        </div>
        <textarea class="editor" id="editorCSS" spellcheck="false" placeholder="Style 1"></textarea>
        <div class="row tiny"><span class="chip">Abas: múltiplos <code class="mono">style</code> inline</span></div>
      </div>
    </section>

    <!-- JS Pane with tabs -->
    <section class="card" id="paneJS">
      <header>
        <h3>JavaScript (abas)</h3>
        <div class="toolbar">
          <button class="btn" id="btnAddScript">+ Script</button>
        </div>
      </header>
      <div class="section">
        <div class="tabbar" id="tabsJS"></div>
        <div class="field" style="margin-bottom:8px">
          <input id="findJS" placeholder="Buscar no JS"/>
          <input id="replJS" placeholder="Substituir por"/>
          <button class="btn" data-find="js" data-op="prev">◀</button>
          <button class="btn" data-find="js" data-op="next">▶</button>
          <button class="btn" data-find="js" data-op="replace">Subst.</button>
          <button class="btn" data-find="js" data-op="replaceAll">Tudo</button>
        </div>
        <textarea class="editor" id="editorJS" spellcheck="false" placeholder="Script 1"></textarea>
        <div class="row tiny"><span class="chip">Abas: múltiplos <code class="mono">script</code> inline</span></div>
      </div>
    </section>

    <!-- Preview + Validate -->
    <section class="card">
      <header>
        <h3>Pré‑visualização & Validação</h3>
        <div class="toolbar">
          <button class="btn" id="btnCompose">Recompor</button>
          <button class="btn primary" id="btnPreview">Pré‑visualizar ▶</button>
          <button class="btn" id="btnValidate">Validar</button>
        </div>
      </header>
      <div class="section split">
        <iframe class="preview" id="preview" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
        <div class="list" id="validationList"></div>
      </div>
    </section>
  </div>

  <div class="stickybar">
    <button class="btn" id="btnBeautifyAll">Auto‑indentar tudo</button>
    <button class="btn" id="btnCopyFinal">Copiar Final</button>
    <button class="btn ok" id="btnExport2">Exportar</button>
  </div>
</div>

<script>
(function(){
  const $ = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

  // Editors state
  const ed = {
    html: {ta: $('#editorHTML'), undo:[], redo:[], find: $('#findHTML'), repl: $('#replHTML')},
    css:  {ta: $('#editorCSS'),  undo:[], redo:[], find: $('#findCSS'),  repl: $('#replCSS'), tabs: [], active: 0},
    js:   {ta: $('#editorJS'),   undo:[], redo:[], find: $('#findJS'),   repl: $('#replJS'),  tabs: [], active: 0},
  };

  // Tabs helpers
  function renderTabs(kind){
    const bar = kind==='css' ? $('#tabsCSS') : $('#tabsJS');
    const s = ed[kind];
    bar.innerHTML='';
    s.tabs.forEach((t,i)=>{
      const b = document.createElement('button');
      b.className = 'tab' + (s.active===i?' active':'');
      b.textContent = t.name || (kind.toUpperCase() + ' ' + (i+1));
      b.addEventListener('click', ()=>{ saveActive(kind); s.active=i; loadActive(kind); });
      bar.appendChild(b);
    });
  }
  function saveActive(kind){
    const s = ed[kind];
    if (!s.tabs.length) return;
    s.tabs[s.active].code = s.ta.value;
  }
  function loadActive(kind){
    const s = ed[kind];
    if (!s.tabs.length){ s.ta.value=''; return; }
    s.ta.value = s.tabs[s.active].code || '';
  }
  function addTab(kind, name, code){
    const s = ed[kind];
    s.tabs.push({name: name || (kind.toUpperCase()+' '+(s.tabs.length+1)), code: code||''});
    s.active = s.tabs.length-1;
    renderTabs(kind); loadActive(kind);
  }

  // Initial tabs
  addTab('css','Style 1','');
  addTab('js','Script 1','');

  // Add tab buttons
  $('#btnAddStyle').addEventListener('click', ()=>addTab('css', 'Style ' + (ed.css.tabs.length+1), ''));
  $('#btnAddScript').addEventListener('click', ()=>addTab('js', 'Script ' + (ed.js.tabs.length+1), ''));

  // Undo/Redo
  function pushUndo(set){
    const val = set.ta.value;
    if (!set.undo.length || set.undo[set.undo.length-1]!==val){
      set.undo.push(val); if (set.undo.length>100) set.undo.shift(); set.redo.length=0;
    }
  }
  function doUndo(set){ if (set.undo.length>1){ const cur=set.undo.pop(); set.redo.push(cur); set.ta.value=set.undo[set.undo.length-1]||''; }}
  function doRedo(set){ if (set.redo.length){ const v=set.redo.pop(); set.undo.push(v); set.ta.value=v; } }
  ['html','css','js'].forEach(k=>{
    ed[k].ta.addEventListener('input', ()=>pushUndo(ed[k]));
    pushUndo(ed[k]);
  });
  $$('.toolbar [data-action]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const tgt = btn.getAttribute('data-target');
      const act = btn.getAttribute('data-action');
      if (act==='undo') doUndo(ed[tgt]);
      if (act==='redo') doRedo(ed[tgt]);
      if (act==='beautify') beautify(tgt);
    });
  });

  // Beautify
  function prettyHTML(html){
    const voids = new Set(['area','base','br','col','embed','hr','img','input','link','meta','param','source','track','wbr']);
    html = html.replace(/>\\s+</g, '><').replace(/\\n+/g,'');
    let out = '', indent=0;
    html.split(/(<[^>]+>)/g).filter(Boolean).forEach(tok=>{
      if (tok.startsWith('<')){
        if (/^<\\//.test(tok)){ indent = Math.max(0, indent-1); }
        out += '  '.repeat(indent) + tok + '\\n';
        if (!/^<\\//.test(tok) && !/\\/\\s*>$/.test(tok)){
          const tag = (tok.match(/^<\\s*([a-zA-Z0-9-]+)/)||[])[1];
          if (tag && !voids.has(tag.toLowerCase()) && !tok.endsWith('/>')) indent++;
        }
      } else if (tok.trim()){
        out += '  '.repeat(indent) + tok.trim() + '\\n';
      }
    });
    return out.trim();
  }
  function prettyCSS(css){
    css = css.replace(/\\s+/g,' ');
    css = css.replace(/\\s*{\\s*/g,' {\\n  ').replace(/;\\s*/g,';\\n  ').replace(/\\s*}\\s*/g,'\\n}\\n');
    css = css.replace(/\\n\\s*\\n/g,'\\n');
    return css.trim();
  }
  function prettyJS(js){
    js = js.replace(/\\r/g,'');
    js = js.replace(/;\\s*/g,';\\n').replace(/\\{\\s*/g,'{\\n').replace(/\\}\\s*/g,'\\n}\\n');
    let out='', indent=0;
    js.split(/\\n/).forEach(line=>{
      line=line.trim(); if (!line) return;
      if (/^\\}/.test(line)) indent = Math.max(0, indent-1);
      out += '  '.repeat(indent)+line+'\\n';
      if (/{\\s*$/.test(line)) indent++;
    });
    return out.trim();
  }
  function beautify(kind){
    if (kind==='html') ed.html.ta.value = prettyHTML(ed.html.ta.value);
    if (kind==='css')  { saveActive('css'); ed.css.tabs[ed.css.active].code = prettyCSS(ed.css.tabs[ed.css.active].code); loadActive('css'); }
    if (kind==='js')   { saveActive('js');  ed.js.tabs[ed.js.active].code   = prettyJS(ed.js.tabs[ed.js.active].code);   loadActive('js'); }
  }
  $('#btnBeautifyAll').addEventListener('click', ()=>{ beautify('html'); ed.css.tabs.forEach((_,i)=>{ed.css.active=i; beautify('css');}); ed.css.active=0; loadActive('css'); ed.js.tabs.forEach((_,i)=>{ed.js.active=i; beautify('js');}); ed.js.active=0; loadActive('js'); });

  // Search/Replace (current editor)
  function findDo(kind, op){
    const set = ed[kind];
    const ta = set.ta;
    const q = (set.find.value||''); if (!q) return;
    if (op==='next' || op==='prev'){
      const text = ta.value; const start = ta.selectionEnd;
      if (op==='next'){
        const idx = text.indexOf(q, start);
        const pos = idx>=0 ? idx : text.indexOf(q, 0);
        if (pos>=0){ ta.focus(); ta.selectionStart=pos; ta.selectionEnd=pos+q.length; ta.scrollTop = ta.scrollTop + 44; }
      } else {
        const before = ta.value.substring(0, ta.selectionStart);
        const idx = before.lastIndexOf(q);
        const alt = ta.value.lastIndexOf(q);
        const pos = idx>=0 ? idx : alt;
        if (pos>=0){ ta.focus(); ta.selectionStart=pos; ta.selectionEnd=pos+q.length; ta.scrollTop = Math.max(0, ta.scrollTop - 44); }
      }
    } else if (op==='replace'){
      if (ta.selectionStart!==ta.selectionEnd){
        const s = ta.selectionStart, e=ta.selectionEnd;
        ta.setRangeText(set.repl.value||'', s, e, 'end');
      } else {
        findDo(kind,'next');
      }
    } else if (op==='replaceAll'){
      const re = new RegExp(set.find.value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      ta.value = ta.value.replace(re, set.repl.value||'');
    }
  }
  $$('[data-find]').forEach(b=>{
    b.addEventListener('click', ()=>{
      const kind = b.getAttribute('data-find');
      const op = b.getAttribute('data-op');
      findDo(kind, op);
    });
  });

  // Compose
  function compose(){
    saveActive('css'); saveActive('js');
    const headBody = ed.html.ta.value;
    const styles = ed.css.tabs.map(t=>t.code).filter(Boolean).map(c=>`<style>\\n${c}\\n</style>`).join('\\n');
    const scripts= ed.js.tabs.map(t=>t.code).filter(Boolean).map(c=>`<script>\\n${c}\\n</script>`).join('\\n');
    let final = '';
    if (/<!doctype/i.test(headBody)){
      // Insert styles into <head> and scripts before </body>
      final = headBody;
      if (styles){
        final = final.replace(/<\/head>/i, styles + '\\n</head>');
      }
      if (scripts){
        if (/<\/body>/i.test(final)) final = final.replace(/<\/body>/i, scripts + '\\n</body>');
        else final += scripts;
      }
    } else {
      final = `<!DOCTYPE html>\\n<html lang="pt-br">\\n<head>\\n<meta charset="utf-8">\\n<meta name="viewport" content="width=device-width, initial-scale=1">\\n<title>Documento</title>\\n${styles}\\n</head>\\n<body>\\n${headBody}\\n${scripts}\\n</body>\\n</html>`;
    }
    return final;
  }

  // Validate (simple heuristics)
  function validate(html){
    const issues = [];
    try {
      const d = new DOMParser().parseFromString(html, 'text/html');
      const ids = {};
      d.querySelectorAll('[id]').forEach(el=>{
        const id = el.id;
        ids[id] = (ids[id]||0)+1;
      });
      Object.keys(ids).forEach(id=>{ if (ids[id]>1) issues.push({t:'warn', msg:`id duplicado: #${id} (${ids[id]}x)`}); });
      d.querySelectorAll('img:not([alt])').forEach(()=>issues.push({t:'warn', msg:'<img> sem alt'}));
      if (!d.title) issues.push({t:'warn', msg:'<title> ausente'});
      if (!d.querySelector('meta[name="viewport"]')) issues.push({t:'warn', msg:'meta viewport ausente'});
      const htmlEl = d.querySelector('html'); if (htmlEl && !htmlEl.getAttribute('lang')) issues.push({t:'warn', msg:'atributo lang ausente em <html>'});
      d.querySelectorAll('a[href="#"], a:not([href])').forEach(()=>issues.push({t:'warn', msg:'link sem href válido'}));
      d.querySelectorAll('script[src^="http:"]').forEach(()=>issues.push({t:'warn', msg:'script externo via HTTP (use HTTPS)'}));
      d.querySelectorAll('link[rel="stylesheet"][href^="http:"]').forEach(()=>issues.push({t:'warn', msg:'stylesheet externo via HTTP (use HTTPS)'}));
      // inline handlers
      d.querySelectorAll('[onclick],[onchange],[oninput],[onload],[onsubmit]').forEach(el=>issues.push({t:'hint', msg:'handler inline encontrado (considere addEventListener)'}));
    } catch(e){
      issues.push({t:'err', msg:String(e)});
    }
    // Basic braces check in CSS/JS
    const cssAll = ed.css.tabs.map(t=>t.code).join('\n');
    const jsAll  = ed.js.tabs.map(t=>t.code).join('\n');
    const cssOpen = (cssAll.match(/{/g)||[]).length, cssClose=(cssAll.match(/}/g)||[]).length;
    if (cssOpen!==cssClose) issues.push({t:'err', msg:`CSS chaves não fechadas: {${cssOpen}}${cssClose}`});
    const jsOpen = (jsAll.match(/{/g)||[]).length, jsClose=(jsAll.match(/}/g)||[]).length;
    if (jsOpen!==jsClose) issues.push({t:'err', msg:`JS chaves não fechadas: {${jsOpen}}${jsClose}`});
    return issues;
  }

  function showValidation(list){
    const box = $('#validationList'); box.innerHTML='';
    if (!list.length){ box.innerHTML = '<div class="li ok">Sem problemas encontrados.</div>'; return; }
    list.forEach(it=>{
      const el = document.createElement('div'); el.className='li';
      const cls = it.t==='err'?'err':(it.t==='warn'?'warn':'hint');
      el.innerHTML = `<span class="${cls}">• ${it.msg}</span><span class="tiny ghost">${it.t.toUpperCase()}</span>`;
      box.appendChild(el);
    });
  }

  // IO buttons
  $('#btnOpen').addEventListener('click', ()=>$('#fileInput').click());
  $('#fileInput').addEventListener('change', async (e)=>{
    const f = e.target.files[0]; if (!f) return;
    const txt = await f.text();
    loadAndSplit(txt);
  });
  $('#btnPaste').addEventListener('click', async ()=>{
    try{ const txt = await navigator.clipboard.readText(); if (txt) loadAndSplit(txt); }catch(e){ alert('Não consegui ler do clipboard.'); }
  });
  $('#btnCopyAll').addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(compose()); alert('HTML copiado'); }catch(e){ alert('Falhou ao copiar'); }
  });
  $('#btnCopyFinal').addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(compose()); alert('Final copiado'); }catch(e){ alert('Falhou ao copiar'); }
  });
  $('#btnExport').addEventListener('click', ()=>exportHTML());
  $('#btnExport2').addEventListener('click', ()=>exportHTML());

  function exportHTML(){
    const blob = new Blob([compose()], {type:'text/html'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = 'export.html'; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1000);
  }

  // Preview & Validate
  $('#btnCompose').addEventListener('click', ()=>compose());
  $('#btnPreview').addEventListener('click', ()=>{ $('#preview').srcdoc = compose(); });
  $('#btnValidate').addEventListener('click', ()=>{ showValidation(validate(compose())); });

  // Split loader
  function loadAndSplit(raw){
    const d = new DOMParser().parseFromString(raw, 'text/html');
    const head = d.head ? d.head.innerHTML : '';
    const body = d.body ? d.body.innerHTML : '';
    ed.html.ta.value = prettyHTML('<head>\\n'+head+'\\n</head>\\n<body>\\n'+body+'\\n</body>');
    // styles
    ed.css.tabs = []; ed.css.active=0;
    const styles = Array.from(d.querySelectorAll('style'));
    if (styles.length){ styles.forEach((s,i)=>addTab('css', 'Style '+(i+1), s.textContent)); }
    else { addTab('css','Style 1',''); }
    // scripts
    ed.js.tabs = []; ed.js.active=0;
    const scripts = Array.from(d.querySelectorAll('script:not([src])'));
    if (scripts.length){ scripts.forEach((s,i)=>addTab('js', 'Script '+(i+1), s.textContent)); }
    else { addTab('js','Script 1',''); }
    alert('Documento carregado.');
  }

})();</script>
</body>
</html>
