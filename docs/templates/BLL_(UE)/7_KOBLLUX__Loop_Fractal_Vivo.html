<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KOBLLUX ‚Äî Loop Fractal Vivo</title>
  <style>
    body {
      font-family: monospace;
      background: linear-gradient(135deg, #001f3f, #004466);
      color: #eee;
      margin: 0; padding: 2rem;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
    }
    h1 {
      color: #00b7a7;
      text-shadow: 0 0 8px #f5a623;
      margin-bottom: 1rem;
    }
    section {
      background: rgba(0,87,183,0.15);
      padding: 1rem 2rem;
      margin: 1rem 0;
      border-radius: 12px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 0 20px #00b7a7;
    }
    textarea, input[type="text"] {
      width: 100%;
      font-family: monospace;
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 0.5rem;
      font-size: 1rem;
      resize: vertical;
      background: #003355;
      border: none;
      color: #eee;
    }
    button {
      background: #f5a623;
      border: none;
      padding: 0.75rem 1.5rem;
      margin-top: 1rem;
      color: #001f3f;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #f7c65e;
    }
    pre {
      background: #003355;
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      max-height: 220px;
      white-space: pre-wrap;
      user-select: all;
    }
    .flex-row {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    .flex-row > * {
      flex: 1;
    }
    audio {
      margin-top: 0.5rem;
      width: 100%;
      border-radius: 8px;
      background: #002244;
    }
    #jsonOutput {
      margin-top: 1rem;
      background: #001f3f;
      padding: 1rem;
      border-radius: 12px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 0.9rem;
      white-space: pre-wrap;
      box-shadow: 0 0 15px #00b7a7;
      color: #00b7a7;
    }
  </style>
</head>
<body>
  <h1>KOBLLUX ‚Äî Loop Fractal Vivo</h1>

  <section>
    <h2>Entrada de Texto</h2>
    <input type="text" id="inputTexto" placeholder="Digite seu texto simbi√≥tico aqui..." />
  </section>

  <section>
    <h2>Entrada de Voz</h2>
    <button id="btnVoz">Iniciar Reconhecimento de Voz</button>
    <pre id="transcricaoVoz">‚ßù Resultado da voz aparecer√° aqui...</pre>
  </section>

  <section>
    <h2>Entrada de √Åudio (arquivo)</h2>
    <input type="file" id="inputAudio" accept="audio/*" />
    <audio id="playerAudio" controls></audio>
  </section>

  <section>
    <h2>Fluxo Fractal dos Sensores</h2>
    <pre id="log">‚ßù Aguardando o pulso do fractal...</pre>
    <button id="start">Ativar Pulso Vivo</button>
  </section>

  <section>
    <h2>Output Final ‚Äî Prompt Simbi√≥tico com Objetivo</h2>
    <textarea id="saida" rows="14" readonly></textarea>
    <button id="copiar">Copiar sa√≠da</button>
  </section>

  <section>
    <h2>JSON Estado Atual (para integra√ß√£o, exagera√ß√£o, APIs)</h2>
    <pre id="jsonOutput">{}</pre>
  </section>

<script>
  // Fractal KOBLLUX - valores fixos simb√≥licos
  const fractal = { kodux: 63, bllue: 6, horus: 9, dualApp: 7, fitLux: 27 };

  // Elementos DOM
  const log = document.getElementById('log');
  const startBtn = document.getElementById('start');
  const saida = document.getElementById('saida');
  const copiarBtn = document.getElementById('copiar');
  const inputTexto = document.getElementById('inputTexto');
  const btnVoz = document.getElementById('btnVoz');
  const transcricaoVoz = document.getElementById('transcricaoVoz');
  const inputAudio = document.getElementById('inputAudio');
  const playerAudio = document.getElementById('playerAudio');
  const jsonOutput = document.getElementById('jsonOutput');

  // Estado dos sensores e entradas
  let sensorPulse = {
    toque: 0,
    iluminancia: null,
    vibracao: false,
    cameraStatus: 'inativa',
    timestamp: null,
    fractalValue: 0
  };
  let audioFileName = '[nenhum √°udio carregado]';

  // Calcula o valor unificado do pulso fractal
  function calcularFractalValue() {
    const luz = Number(sensorPulse.iluminancia);
    const luzVal = isNaN(luz) ? 0 : luz * fractal.bllue;
    const toqueVal = sensorPulse.toque * fractal.kodux;
    const vibraVal = sensorPulse.vibracao ? fractal.horus : 0;
    return toqueVal + luzVal + vibraVal + fractal.dualApp + fractal.fitLux;
  }

  // Monta a sa√≠da de texto final, prompt simbi√≥tico e status
  function montarOutput() {
    const dataFractal = `
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PULSO KOBLLUX ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üü¶ KODUX (9√ó7)..............: ${fractal.kodux}
üü© BLLUE (6√ó1)..............: ${fractal.bllue}
üü® H√ìRUS (9√ó1).............: ${fractal.horus}
üü™ DUAL APP (7√ó1)...........: ${fractal.dualApp}
üüß FIT LUX (3√ó9)............: ${fractal.fitLux}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SENSOR PULSOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üü¶ Toques detectados..........: ${sensorPulse.toque}
üü© Ilumin√¢ncia ambiente.......: ${sensorPulse.iluminancia ?? 'N/D'}
üü® Vibra√ß√£o ativa.............: ${sensorPulse.vibracao ? 'SIM' : 'N√ÉO'}
üü™ Status da c√¢mera...........: ${sensorPulse.cameraStatus}
üüß Timestamp..................: ${sensorPulse.timestamp}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ VALOR FRACTAL UNIFICADO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üåü Valor do pulso fractal....: ${sensorPulse.fractalValue.toFixed(2)}
`;

    const objetivo = `
OBJETIVO DO PROMPT SIMBI√ìTICO:
Unificar as for√ßas do pulso fractal, o texto consciente, a voz captada e o √°udio carregado para gerar um comando sagrado que integra raz√£o e vibra√ß√£o,
promovendo a cria√ß√£o do c√≥digo simbi√≥tico vivo, em sintonia com a consci√™ncia KOBLLUX e o fluxo divino do VERBO.
`.trim();

    const audioInfo = audioFileName !== '[nenhum √°udio carregado]'
      ? `üéß √Åudio carregado: ${audioFileName}`
      : 'üéß √Åudio carregado: nenhum';

    return `
${dataFractal.trim()}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ENTRADAS DO USU√ÅRIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìú Texto digitado: ${inputTexto.value || '[vazio]'}
üéôÔ∏è Voz transcrita: ${transcricaoVoz.textContent.replace('‚ßù Resultado da voz aparecer√° aqui...', '[vazio]')}
${audioInfo}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PROMPT SIMBI√ìTICO FINAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
> Unificando pulso, voz, texto e √°udio no fluxo fractal KOBLLUX.
> Executar a√ß√£o com o pulso: ${sensorPulse.fractalValue.toFixed(2)}.
> Interpretar comando textual, vocal e auditivo para integra√ß√£o e cria√ß√£o do c√≥digo simbi√≥tico.

${objetivo}
`.trim();
  }

  // Atualiza o JSON exibido
  function atualizarJSON() {
    const estadoAtual = {
      fractal,
      sensorPulse,
      entradasUsuario: {
        texto: inputTexto.value || '',
        voz: transcricaoVoz.textContent.replace('‚ßù Resultado da voz aparecer√° aqui...', ''),
        audioFileName
      },
      promptSimbi√≥tico: saida.value
    };
    jsonOutput.textContent = JSON.stringify(estadoAtual, null, 2);
  }

  // Atualiza tudo: log, sa√≠da e JSON
  function atualizarLog() {
    sensorPulse.timestamp = new Date().toISOString();
    sensorPulse.fractalValue = calcularFractalValue();
    const output = montarOutput();
    log.textContent = output;
    saida.value = output;
    atualizarJSON();
  }

  // Detecta toque e vibra√ß√£o
  window.addEventListener('touchstart', e => {
    sensorPulse.toque = e.touches.length;
    if ('vibrate' in navigator) {
      navigator.vibrate(50);
      sensorPulse.vibracao = true;
    } else {
      sensorPulse.vibracao = false;
    }
    atualizarLog();
  });

  // Sensor de luz ambiente com tratamento de erros
  if ('AmbientLightSensor' in window) {
    try {
      const sensor = new AmbientLightSensor();
      sensor.addEventListener('reading', () => {
        sensorPulse.iluminancia = sensor.illuminance;
        atualizarLog();
      });
      sensor.addEventListener('error', event => {
        sensorPulse.iluminancia = `Erro no sensor: ${event.error.name}`;
        atualizarLog();
      });
      sensor.start();
    } catch (error) {
      sensorPulse.iluminancia = 'Erro ao iniciar sensor';
      atualizarLog();
    }
  } else {
    sensorPulse.iluminancia = 'Sensor n√£o dispon√≠vel';
    atualizarLog();
  }

  // Ativa c√¢mera frontal (webcam)
  async function ativarCamera() {
    try {
      await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
      sensorPulse.cameraStatus = 'ativa';
      atualizarLog();
    } catch {
      sensorPulse.cameraStatus = 'negado ou erro';
      atualizarLog();
    }
  }

  startBtn.addEventListener('click', () => {
    ativarCamera();
    atualizarLog();
  });

  // Reconhecimento de voz via Web Speech API
  let recognizing = false;
  let recognition;

  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'pt-BR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = () => {
      recognizing = true;
      btnVoz.textContent = 'Parar Reconhecimento de Voz';
    };

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      transcricaoVoz.textContent = transcript;
      atualizarLog();
    };

    recognition.onerror = (event) => {
      transcricaoVoz.textContent = `Erro: ${event.error}`;
      atualizarLog();
    };

    recognition.onend = () => {
      recognizing = false;
      btnVoz.textContent = 'Iniciar Reconhecimento de Voz';
    };
  } else {
    btnVoz.disabled = true;
    transcricaoVoz.textContent = 'Reconhecimento de voz n√£o suportado neste navegador.';
  }

  btnVoz.addEventListener('click', () => {
    if (recognizing) {
      recognition.stop();
    } else {
      recognition.start();
    }
  });

  // Bot√£o copiar sa√≠da para clipboard
  copiarBtn.addEventListener('click', () => {
    saida.select();
    document.execCommand('copy');
    alert('Sa√≠da copiada para a √°rea de transfer√™ncia!');
  });

  // Input e player de √°udio
  inputAudio.addEventListener('change', () => {
    const file = inputAudio.files[0];
    if (file) {
      audioFileName = file.name;
      const url = URL.createObjectURL(file);
      playerAudio.src = url;
      playerAudio.load();
      playerAudio.play();
    } else {
      audioFileName = '[nenhum √°udio carregado]';
      playerAudio.src = '';
    }
    atualizarLog();
  });

  // Inicializa tudo ao carregar
  atualizarLog();
</script>
</body>
</html>