<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KOBLLUX ‚à¥ C√≥digo Vivo - Refatora√ß√£o Final</title>
<style>
  /* Reset e base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    background: #0e0e11;
    color: #e0e0e0;
    font-family: 'Consolas', monospace;
    margin: 0;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    min-height: 100vh;
  }
  .balloon {
    background: linear-gradient(135deg, #121214, #1a1a1f);
    border-radius: 1rem;
    padding: 1rem;
    box-shadow:
      0 0 15px 3px #2a9df4cc,
      inset 0 0 10px #0f70ff88;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    min-height: 35vh;
    max-height: 50vh;
    flex: 1 1 auto;
  }
  h2 {
    margin: 0 0 0.5rem 0;
    font-weight: 600;
    text-align: center;
    text-shadow: 0 0 8px #2a9df4cc;
    user-select: none;
    font-size: 1.3rem;
  }
  /* Menu camadas */
  #layerMenu {
    display: flex;
    justify-content: center;
    gap: 0.6rem;
    margin-bottom: 1rem;
    user-select: none;
    flex-wrap: wrap;
  }
  #layerMenu button {
    background: #101018;
    border: 1.5px solid #2a9df4cc;
    border-radius: 0.5rem;
    color: #62dafb;
    padding: 0.4rem 0.8rem;
    font-family: 'Consolas', monospace;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.25s ease, color 0.25s ease;
    box-shadow: 0 0 6px #2a9df4cc;
    min-width: 60px;
    text-align: center;
  }
  #layerMenu button.active,
  #layerMenu button:hover {
    background: #2a9df4f0;
    color: #0af;
    box-shadow: 0 0 15px 3px #0af;
  }
  /* Bot√µes topo dentro dos bal√µes */
  .topButtons {
    display: flex;
    gap: 0.6rem;
    justify-content: center;
    margin-bottom: 0.8rem;
    flex-wrap: wrap;
  }
  .topButtons button {
    background: #101018;
    border: 1.5px solid #2a9df4cc;
    border-radius: 0.5rem;
    color: #62dafb;
    padding: 0.35rem 0.75rem;
    font-family: 'Consolas', monospace;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.25s ease, color 0.25s ease;
    box-shadow: 0 0 6px #2a9df4cc;
    min-width: 80px;
    text-align: center;
    user-select: none;
  }
  .topButtons button:hover {
    background: #2a9df4f0;
    color: #0af;
    box-shadow: 0 0 15px 3px #0af;
  }
  /* Textarea entrada */
  #inputArea {
    flex: 1;
    background: #0b0b0f;
    border: none;
    border-radius: 0.5rem;
    color: #c0d8f8;
    font-family: 'Consolas', monospace;
    font-size: 0.95rem;
    padding: 1rem;
    resize: none;
    box-shadow: inset 0 0 10px #0f70ff88;
    outline-offset: 2px;
    outline-color: transparent;
    outline-style: solid;
    outline-width: 2px;
    transition: box-shadow 0.3s ease, outline-color 0.3s ease, background 0.3s ease;
    min-height: 120px;
    white-space: pre-wrap;
    line-height: 1.4;
  }
  #inputArea:focus {
    box-shadow: inset 0 0 18px #1a9dffcc;
    outline-color: #1a9dffcc;
    background: #101018;
  }
  /* √Årea sa√≠da */
  #outputArea {
    flex: 1;
    background: #101018;
    border-radius: 0.5rem;
    overflow-y: auto;
    padding: 1rem;
    font-size: 0.9rem;
    user-select: text;
    min-height: 120px;
    white-space: pre-wrap;
    line-height: 1.4;
    word-wrap: break-word;
  }
  /* Visualiza√ß√£o √°rvore HTML */
  .node {
    margin-left: 1rem;
    border-left: 1px dotted #2a9df4aa;
    padding-left: 0.8rem;
    margin-bottom: 0.4rem;
  }
  .tag {
    color: #62dafb;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
  }
  .attributes {
    color: #ffb86c;
    font-style: italic;
  }
  .text-node {
    color: #f8f8f2;
    font-style: normal;
    margin-left: 1.5rem;
    white-space: pre-wrap;
  }
  /* Cores categorias texto KOBLLUX */
  .verbo {
    color: #f57c00; /* laranja */
    font-weight: 600;
  }
  .substantivo {
    color: #2979ff; /* azul */
    font-weight: 600;
  }
  .adjetivo {
    color: #388e3c; /* verde */
    font-weight: 600;
  }
  /* T√≠tulos internos da lapida√ß√£o texto */
  #outputArea h3 {
    margin: 0 0 0.3rem 0;
    border-bottom: 1px solid #2a9df4cc;
    color: #72c7ff;
    user-select: none;
    font-size: 1.1rem;
  }
  #outputArea strong {
    color: #88d8ff;
    user-select: none;
    margin-right: 0.3rem;
    font-weight: 700;
  }
  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-thumb {
    background: #2a9df4cc;
    border-radius: 4px;
  }
  ::-webkit-scrollbar-track {
    background: #0e0e11;
  }
  /* Responsividade */
  @media (max-width: 600px) {
    body {
      padding: 0.5rem;
    }
    .balloon {
      min-height: 30vh;
      max-height: 45vh;
      padding: 0.7rem;
    }
    h2 {
      font-size: 1.1rem;
    }
    #layerMenu button,
    .topButtons button {
      padding: 0.3rem 0.6rem;
      font-size: 0.85rem;
      min-width: 50px;
    }
    #inputArea, #outputArea {
      font-size: 0.85rem;
    }
  }
</style>
</head>
<body>

  <section class="balloon" aria-label="Bal√£o de entrada">
    <h2>Entrada</h2>
    <div class="topButtons" aria-label="Bot√µes de entrada">
      <button id="pasteBtn" type="button" title="Colar do clipboard">üìã Colar</button>
      <button id="openFileBtn" type="button" title="Abrir arquivo do dispositivo">üìÇ Abrir arquivo</button>
      <input type="file" id="fileInput" accept=".txt,.json,.py,.java,.html,.pdf,text/plain,application/pdf" style="display:none" />
    </div>
    <nav id="layerMenu" aria-label="Selecionar camada de linguagem">
      <button data-layer="text" class="active" type="button">Texto</button>
      <button data-layer="html" type="button">HTML</button>
      <button data-layer="python" type="button">Python</button>
      <button data-layer="json" type="button">JSON</button>
      <button data-layer="java" type="button">Java</button>
      <button data-layer="note" type="button">ùô£ùô§ùô©ùôö</button>
    </nav>
    <textarea id="inputArea" spellcheck="false" placeholder="Digite ou cole seu texto aqui..."></textarea>
  </section>

  <section class="balloon" aria-label="Bal√£o de sa√≠da">
    <h2>Sa√≠da Estruturada</h2>
    <div class="topButtons" aria-label="Bot√µes de sa√≠da">
      <button id="copyBtn" type="button" title="Copiar sa√≠da">üìã Copiar</button>
      <button id="exportBtn" type="button" title="Exportar sa√≠da como arquivo TXT">üíæ Exportar</button>
    </div>
    <div id="outputArea" role="region" aria-live="polite" tabindex="0"></div>
  </section>

<script>
  const layerButtons = document.querySelectorAll('#layerMenu button');
  const inputArea = document.getElementById('inputArea');
  const outputArea = document.getElementById('outputArea');
  const pasteBtn = document.getElementById('pasteBtn');
  const openFileBtn = document.getElementById('openFileBtn');
  const fileInput = document.getElementById('fileInput');
  const copyBtn = document.getElementById('copyBtn');
  const exportBtn = document.getElementById('exportBtn');

  let currentLayer = 'text';

  const verbos = ['√©', 'ser', 'estar', 'fazer', 'ter', 'poder', 'dizer', 'ir', 'ver', 'dar', 'gira', 'integra'];
  const substantivos = ['nome', 'mandala', 'verdade', 'integra√ß√£o', 'centro', 'resto', 'texto', 'frase', 'verso', 'estrofe'];
  const adjetivos = ['vivo', 'grande', 'fractal', 'sagrado', 'primeiro', 'interior', 'livre', 'claro'];

  function categorizarPalavra(palavra) {
    const p = palavra.toLowerCase().replace(/[.,;:!?]/g, '');
    if (verbos.includes(p)) return 'verbo';
    if (substantivos.includes(p)) return 'substantivo';
    if (adjetivos.includes(p)) return 'adjetivo';
    return 'neutro';
  }

  function clearOutput() {
    outputArea.innerHTML = '';
  }

  function lapidarTexto(texto) {
    if (!texto.trim()) return '<em>Sem conte√∫do para lapidar</em>';

    const frases = texto.split(/(?<=[.!?])\s+/);
    let html = '';

    frases.forEach((frase, i) => {
      html += `<h3>Frase ${i + 1}</h3><p>`;
      const palavras = frase.split(/\s+/).filter(w => w.length > 0);
      palavras.forEach(palavra => {
        const categoria = categorizarPalavra(palavra);
        if (categoria === 'neutro') {
          html += `${palavra} `;
        } else {
          html += `<span class="${categoria}">${palavra}</span> `;
        }
      });
      html += '</p>';
    });

    return html;
  }

  function createNodeElement(node) {
    const el = document.createElement('div');
    el.classList.add('node');

    switch (node.nodeType) {
      case Node.ELEMENT_NODE: {
        const tagName = document.createElement('span');
        tagName.textContent = `<${node.tagName.toLowerCase()}>`;
        tagName.classList.add('tag');
        el.appendChild(tagName);

        if (node.attributes.length > 0) {
          const attrSpan = document.createElement('span');
          attrSpan.classList.add('attributes');
          let attrText = ' [';
          for (const attr of node.attributes) {
            attrText += `${attr.name}="${attr.value}" `;
          }
          attrSpan.textContent = attrText.trim() + ']';
          el.appendChild(attrSpan);
        }

        for (const child of node.childNodes) {
          el.appendChild(createNodeElement(child));
        }
        break;
      }
      case Node.TEXT_NODE: {
        const trimmedText = node.textContent.trim();
        if (trimmedText.length > 0) {
          const textSpan = document.createElement('div');
          textSpan.classList.add('text-node');
          textSpan.textContent = trimmedText;
          el.appendChild(textSpan);
        } else {
          return document.createDocumentFragment();
        }
        break;
      }
      case Node.COMMENT_NODE: {
        const commentSpan = document.createElement('div');
        commentSpan.style.color = '#6272a4';
        commentSpan.style.fontStyle = 'italic';
        commentSpan.textContent = `<!-- ${node.textContent.trim()} -->`;
        el.appendChild(commentSpan);
        break;
      }
    }
    return el;
  }

  function processarHTML(htmlString) {
    const parser = new DOMParser();
    try {
      const doc = parser.parseFromString(htmlString, 'text/html');
      clearOutput();
      outputArea.appendChild(createNodeElement(doc.body));
    } catch {
      outputArea.innerHTML = '<em>Erro ao parsear HTML</em>';
    }
  }

  function processarTexto(texto) {
    clearOutput();
    outputArea.innerHTML = lapidarTexto(texto);
  }

  function processarPython(texto) {
    clearOutput();
    outputArea.textContent = texto || '<em>Insira c√≥digo Python para processar</em>';
  }

  function processarJSON(texto) {
    clearOutput();
    try {
      const obj = JSON.parse(texto);
      outputArea.textContent = JSON.stringify(obj, null, 2);
    } catch {
      outputArea.innerHTML = '<em>JSON inv√°lido</em>';
    }
  }

  function processarJava(texto) {
    clearOutput();
    outputArea.textContent = texto || '<em>Insira c√≥digo Java para processar</em>';
  }

  function processarNote(texto) {
    clearOutput();
    outputArea.textContent = texto || '<em>Camada ùô£ùô§ùô©ùôö</em>';
  }

  function processarInput(texto) {
    switch(currentLayer) {
      case 'text': return processarTexto(texto);
      case 'html': return processarHTML(texto);
      case 'python': return processarPython(texto);
      case 'json': return processarJSON(texto);
      case 'java': return processarJava(texto);
      case 'note': return processarNote(texto);
      default:
        clearOutput();
        outputArea.innerHTML = '<em>Camada desconhecida</em>';
    }
  }

  layerButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      layerButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentLayer = btn.dataset.layer;
      processarInput(inputArea.value);
      inputArea.focus();
    });
  });

  pasteBtn.addEventListener('click', async () => {
    try {
      const text = await navigator.clipboard.readText();
      if (text) {
        inputArea.value = text;
        processarInput(text);
      }
    } catch {
      alert('N√£o foi poss√≠vel acessar o clipboard.');
    }
  });

  openFileBtn.addEventListener('click', () => {
    fileInput.value = null;
    fileInput.click();
  });

  fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    if (!file) return;

    if (file.type === 'application/pdf') {
      alert('Leitura de PDF n√£o implementada neste prot√≥tipo.');
      return;
    }

    const reader = new FileReader();
    reader.onload = e => {
      inputArea.value = e.target.result;
      processarInput(inputArea.value);
    };
    reader.readAsText(file);
  });

  copyBtn.addEventListener('click', async () => {
    try {
      const text = outputArea.innerText || outputArea.textContent;
      await navigator.clipboard.writeText(text);
      alert('Conte√∫do copiado para a √°rea de transfer√™ncia!');
    } catch {
      alert('Erro ao copiar conte√∫do.');
    }
  });

  exportBtn.addEventListener('click', () => {
    const text = outputArea.innerText || outputArea.textContent;
    const blob = new Blob([text], {type: 'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'saida_kobllux.txt';
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 100);
  });

  inputArea.addEventListener('input', e => processarInput(e.target.value));

  processarInput(inputArea.value);
</script>

</body>
</html>